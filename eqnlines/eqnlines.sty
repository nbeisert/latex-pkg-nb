%%
%% This is file `eqnlines.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% eqnlines.dtx  (with options: `package')
%% 
%% Copyright (C) 2024-2025 Niklas Beisert
%% 
%% Based on the latex package amsmath:
%% Copyright (C) 1995, 2000, 2013 American Mathematical Society.
%% Copyright (C) 2016-2024 LaTeX Project and American Mathematical Society.
%% 
%% This work may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either version 1.3
%% of this license or (at your option) any later version.
%% The latest version of this license is in
%%   https://www.latex-project.org/lppl.txt
%% and version 1.3c or later is part of all distributions of LaTeX
%% version 2008 or later.
%% 
\NeedsTeXFormat{LaTeX2e}[2020/10/01]
\ProvidesPackage{eqnlines}[2025/04/03 v0.7 Single- and multi-line equations]
\let\eql@false\@undefined
\let\eql@true\@empty
\ifdefined\dollardollar@begin
  \def\eql@dollardollar@begin{\dollardollar@begin}
  \def\eql@dollardollar@end{\dollardollar@end}
\else
  \def\eql@dollardollar@begin{$$}
  \def\eql@dollardollar@end{$$}
\fi
\let\eql@ifnextchar@loose\kernel@ifnextchar
\long\def\eql@ifnextchar@tight#1#2#3{%
  \let\reserved@d= #1%
  \def\reserved@a{#2}%
  \def\reserved@b{#3}%
  \futurelet\@let@token\eql@ifnch@tight
}
\def\eql@ifnch@tight{%
  \ifx\@let@token\reserved@d
    \let\reserved@b\reserved@a
  \fi
  \reserved@b
}
\begingroup
  \makeatother
  \let\tmp=@%
  \makeatletter
  \global\let\eql@atxii\tmp
\endgroup
\long\def\eql@ifnextgobble@loose#1#2{\eql@ifnextchar@loose#1{\@firstoftwo{#2}}}
\long\def\eql@ifnextgobble@tight#1#2{\eql@ifnextchar@tight#1{\@firstoftwo{#2}}}
\long\def\eql@ifstar@loose#1{\eql@ifnextchar@loose*{\@firstoftwo{#1}}}
\long\def\eql@ifstar@tight#1{\eql@ifnextchar@tight*{\@firstoftwo{#1}}}
\long\def\eql@ifat@loose#1#2{\eql@ifnextgobble@loose{@}{#1}{%
  \eql@ifnextgobble@loose\eql@atxii{#1}{#2}}}
\long\def\eql@ifat@tight#1#2{\eql@ifnextgobble@tight{@}{#1}{%
  \eql@ifnextgobble@tight\eql@atxii{#1}{#2}}}
\long\def\eql@testopt@loose#1#2{\eql@ifnextchar@loose[{#1}{#1[{#2}]}}%]
\long\def\eql@testopt@tight#1#2{\eql@ifnextchar@tight[{#1}{#1[{#2}]}}%]
\long\def\eql@teststaropt@loose#1#2#3{%
  \eql@ifstar@loose{\eql@testopt@loose{#1}{#3}}{\eql@testopt@loose{#2}{#3}}}
\long\def\eql@teststaropt@tight#1#2#3{%
  \eql@ifstar@tight{\eql@testopt@tight{#1}{#3}}{\eql@testopt@tight{#2}{#3}}}
\def\eql@spbgroup{\iffalse{\fi\ifnum0=`}\fi}
\def\eql@spegroup{\ifnum0=`{\fi\iffalse}\fi}
\def\eql@srbgroup{\relax\iffalse{\fi\ifnum0=`}\fi}
\def\eql@sregroup{\let\@let@token\relax\ifnum0=`{\fi\iffalse}\fi}
\long\def\eql@ampprotect#1#2{\eql@srbgroup#1{\eql@sregroup#2}}
\long\def\eql@ampprotecttwo#1#2#3{%
  \eql@srbgroup#1{\eql@sregroup#2}{\eql@sregroup#3}}
\def\eql@ifnextchar@loose@ampsafe#1{%
  \eql@ampprotecttwo{\eql@ifnextchar@loose#1}}
\def\eql@ifnextchar@tight@ampsafe#1{%
  \eql@ampprotecttwo{\eql@ifnextchar@tight#1}}
\def\eql@ifstar@loose@ampsafe{\eql@ampprotecttwo\eql@ifstar@loose}
\def\eql@ifstar@tight@ampsafe{\eql@ampprotecttwo\eql@ifstar@tight}
\def\eql@testopt@loose@ampsafe{\eql@ampprotect\eql@testopt@loose}
\def\eql@testopt@tight@ampsafe{\eql@ampprotect\eql@testopt@tight}
\def\eql@teststaropt@loose@ampsafe{\eql@ampprotecttwo\eql@teststaropt@loose}
\long\def\eql@teststaropt@tight@ampsafe{%
  \eql@ampprotecttwo\eql@teststaropt@tight}
\let\eql@ifnextchar@org\@ifnextchar
\let\eql@ifstar@org\@ifstar
\let\eql@testopt@org\@testopt
\def\eql@amprevert{%
  \let\@ifnextchar\eql@ifnextchar@org
  \let\@testopt\eql@testopt@org
  \let\@ifstar\eql@ifstar@org
}
\def\eql@ampproof{%
  \let\@ifnextchar\eql@ifnextchar@loose@ampsafe
  \let\@testopt\eql@testopt@loose@ampsafe
  \let\@ifstar\eql@ifstar@loose@ampsafe
}
\def\eql@error#1{\PackageError{eqnlines}{#1}{}}
\def\eql@warning{\PackageWarning{eqnlines}}
\def\eql@error@nomathmode#1{\eql@error{#1 allowed only in math mode}}
\def\eql@error@mathmode#1{\eql@error{#1 allowed only in paragraph mode}}
\def\eql@warn@label@unused{\eql@warning{Unused equation \string\label:
      label `\eql@nextlabel' will be lost}}
\def\eql@warn@label@multiple#1{\eql@warning{Multiple equation \string\label's:
      previous label '#1' will be lost}}
\def\eql@warn@tag@unused{\eql@warning{Unused equation \string\tag:
      tag declaration will be lost}}
\def\eql@warn@tag@multiple{\eql@warning{Multiple equation \string\tag's:
      previous tag declaration will be lost}}
\def\eql@amsmath@after#1{\AddToHook{package/amsmath/after}{#1}}
\def\eql@amsmath@before#1{%
  \@ifpackageloaded{amsmath}{}{\AddToHook{package/amsmath/before}{#1}}}
\def\eql@amsmath@undefine#1{\eql@amsmath@before{\let#1\@undefined}}
\def\eql@amsmath@let#1#2{\eql@amsmath@undefine#1\let#1#2}
\let\eql@tagging@on\eql@false
\IfFormatAtLeastTF{2025-06-01}{%
  \csname tag_if_active:T\endcsname{\let\eql@tagging@on\eql@true}}{}
\ifdefined\eql@tagging@on
  \def\eql@tagging@mathsave{%
    \UseTaggingSocket{math/luamml/save/nNn}{{}\displaystyle{mtd}}}
  \def\eql@tagging@mathaddlast{%
    \UseTaggingSocket{math/luamml/mtable/finalizecol}{last}}
  \def\eql@tagging@tagbegin{%
    \UseTaggingSocket{math/display/tag/begin}}
  \def\eql@tagging@tagend{%
    \UseTaggingSocket{math/display/tag/end}}
  \def\eql@tagging@tagsave{%
    \UseTaggingSocket{math/luamml/mtable/tag/save}}
  \def\eql@tagging@tagaddbox{%
    \setbox\z@\copy\eql@tagbox@%
    \UseTaggingSocket{math/luamml/mtable/tag/set}}
  \def\eql@tagging@tablesaveinner{%
    \UseExpandableTaggingSocket{math/luamml/mtable/innertable/save}}
  \def\eql@tagging@tableaddinner{%
    \UseTaggingSocket{math/luamml/mtable/innertable/finalize}}
  \def\eql@tagging@tablesavelines{%
    \UseExpandableTaggingSocket{math/luamml/mtable/finalize}{gather}}
  \def\eql@tagging@tablesavealign{%
    \UseExpandableTaggingSocket{math/luamml/mtable/finalize}{align}}
  \def\eql@tagging@alignleft{%
    \UseTaggingSocket{math/luamml/mtable/aligncol}{left}}
  \def\eql@tagging@aligncenter{%
    \UseTaggingSocket{math/luamml/mtable/aligncol}{center}}
  \def\eql@tagging@alignright{%
    \UseTaggingSocket{math/luamml/mtable/aligncol}{right}}
  \let\eql@single@doscan\eql@true
  \let\eql@scan@body\eql@scan@body@rescan
  \ExplSyntaxOn
  \def\eql@tagging@start{%
    \bool_if:NF\l__math_collected_bool{%
      \toks@\expandafter{\eql@tagging@opt}%
      \edef\eql@tmp{{\@currenvir}{[\the\toks@] \the\eql@scan@reg@}}%
      \expandafter\__math_process:nn\eql@tmp
      \@kernel@math@registered@begin
      \bool_set_true:N\l__math_collected_bool
    }%
  }
  \def\eql@tagging@end{}
  \ExplSyntaxOff
\else
  \def\eql@tagging@mathsave{}
  \def\eql@tagging@mathaddlast{}
  \def\eql@tagging@tagbegin{}
  \def\eql@tagging@tagend{}
  \def\eql@tagging@tagsave{}
  \def\eql@tagging@tagaddbox{}
  \def\eql@tagging@tablesaveinner{}
  \def\eql@tagging@tableaddinner{}
  \def\eql@tagging@tablesavelines{}
  \def\eql@tagging@tablesavealign{}
  \def\eql@tagging@alignleft{}
  \def\eql@tagging@aligncenter{}
  \def\eql@tagging@alignright{}
  \def\eql@tagging@start{}
  \def\eql@tagging@end{}
\fi
\let\eql@tagsleft\eql@false
\let\eql@layoutleft\eql@false
\newdimen\eql@layoutleftmargin@
\newdimen\eql@layoutleftmarginmin@
\newdimen\eql@layoutleftmarginmax@
\def\eql@layoutleftmargin@val{\leftmargini}
\eql@layoutleftmarginmin@\z@
\eql@layoutleftmarginmax@.5\maxdimen
\newdimen\eql@tagmargin@
\let\eql@tagmargin@val\@undefined
\newdimen\eql@tagmargin@ratio@
\eql@tagmargin@ratio@\p@
\def\eql@tagmargin@threshold{0.5}
\newdimen\eql@indent@
\def\eql@indent@val{2em}
\newdimen\eql@paddingleft@
\newdimen\eql@paddingright@
\def\eql@paddingleft@val{0pt}
\def\eql@paddingright@val{0pt}
\let\eql@paddingmax\eql@false
\def\eql@box@marginleft{\z@skip}
\def\eql@box@marginright{\z@skip}
\def\eql@box@colsep{2em}
\def\eql@spread@val{\jot}
\newdimen\eql@spread@
\newdimen\eql@tagfuzz@
\eql@tagfuzz@16sp\relax
\def\eql@display@height{\ht\eql@strutbox@}
\def\eql@display@depth{\dp\eql@strutbox@}
\def\eql@skip@mode@short{2}
\def\eql@skip@mode@cont@above{2}
\def\eql@skip@mode@cont@below{0}
\def\eql@skip@mode@par@above{3}
\def\eql@skip@mode@par@below{0}
\def\eql@skip@mode@top@above{4}
\def\eql@skip@mode@top@below{0}
\newcount\eql@skip@mode@leave@
\let\eql@skip@force@leave\@undefined
\newcount\eql@skip@mode@above@
\newcount\eql@skip@mode@below@
\let\eql@skip@force@above\@undefined
\let\eql@skip@force@below\@undefined
\let\eql@skip@custom@above\@undefined
\let\eql@skip@custom@below\@undefined
\def\eql@skip@long@above{\abovedisplayskip}
\def\eql@skip@long@below{\belowdisplayskip}
\def\eql@skip@short@above{\abovedisplayshortskip}
\def\eql@skip@short@below{\belowdisplayshortskip}
\def\eql@skip@cont@above{\eql@skip@short@above}
\def\eql@skip@cont@below{\eql@skip@short@below}
\def\eql@skip@par@above{\eql@skip@long@above}
\def\eql@skip@par@below{\eql@skip@long@below}
\def\eql@skip@top@above{\eql@skip@long@above}
\def\eql@skip@top@below{\eql@skip@long@below}
\def\eql@skip@med@above{\abovedisplayskip/2}
\def\eql@skip@med@below{\belowdisplayskip/2}
\def\eql@skip@tag@above{\z@skip}
\def\eql@skip@tag@below{\z@skip}
\def\eql@skip@partag@above{\z@skip}
\def\eql@skip@partag@below{\z@skip}
\def\eql@skip@medtag@above{\z@skip}
\def\eql@skip@medtag@below{\z@skip}
\newdimen\eql@colsepmin@
\def\eql@colsepmin@val{1em}
\def\eql@colsepmax@val{.5\maxdimen}
\newdimen\eql@tagwidthmin@
\eql@tagwidthmin@\z@
\newdimen\eql@tagsepmin@
\def\eql@tagsepmin@val{.5\fontdimen6\textfont\tw@}
\def\eql@equations@sqr@opt{equation,nonumber}
\def\eql@equations@ang@opt{align,nonumber}
\let\eql@columns@margins\eql@true
\newbox\eql@fieldbox@
\newbox\eql@tagbox@
\newdimen\eql@fieldwidth@
\newdimen\eql@tagwidth@
\newdimen\eql@totalwidth@
\newdimen\eql@tagwidth@max@
\newdimen\eql@line@height@
\newdimen\eql@line@depth@
\newdimen\eql@line@width@
\newdimen\eql@line@avail@
\newdimen\eql@line@pos@
\newcount\eql@row@
\newcount\eql@totalrows@
\newcount\eql@tagrows@
\newcount\eql@column@
\newcount\eql@totalcolumns@
\newdimen\eql@colsep@
\newcount\eql@columns@inter@
\newdimen\eql@display@firstavail@
\def\eql@display@firstavail@set#1{%
  \ifnum\eql@row@=\@ne
    \global\eql@display@firstavail@#1%
  \fi
}
\newcount\eql@raisetag@firstlast@
\ifdefined\measuring@true\else
  \expandafter\newif\csname ifmeasuring@\endcsname
\fi
\AddToHook{package/hyperref/after}{
  \ifdefined\Hy@ifnotmeasuring
    \renewcommand\Hy@ifnotmeasuring[1]{\ifmeasuring@\else#1\fi}
  \fi
}
\ifdefined\@displaytrue\else
  \expandafter\newif\csname if@display\endcsname
  \everydisplay\expandafter{\the\everydisplay\@displaytrue}
\fi
\let\eql@hook@blockbefore\@empty
\let\eql@hook@blockafter\@empty
\let\eql@hook@blockin\@empty
\let\eql@hook@blockout\@empty
\let\eql@hook@linein\@empty
\let\eql@hook@lineout\@empty
\let\eql@hook@colin\@empty
\let\eql@hook@colout\@empty
\let\eql@hook@eqin\@empty
\let\eql@hook@eqout\@empty
\let\eql@hook@innerleft\@empty
\let\eql@hook@innerright\@empty
\let\eql@hook@innerlead\@empty
\let\eql@punct@col\@empty
\let\eql@punct@line\relax
\let\eql@punct@block\relax
\let\eql@punct@sep\relax
\def\eqnpunctcol{\eql@ifstar@tight\eql@punct@col@setrelax\eql@punct@col@set}
\def\eql@punct@col@set#1{\def\eql@punct@col{#1}\ignorespaces}
\def\eql@punct@col@setrelax{\let\eql@punct@col\@empty\ignorespaces}
\def\eqnpunctline{\eql@ifstar@tight\eql@punct@line@setrelax\eql@punct@line@set}
\def\eql@punct@line@set#1{\def\eql@punct@line{#1}\ignorespaces}
\def\eql@punct@line@setrelax{\let\eql@punct@line\relax\ignorespaces}
\def\eqnpunctmain{\eql@ifstar@tight\eql@punct@main@setrelax\eql@punct@main@set}
\def\eql@punct@main@set#1{\def\eql@punct@main{#1}\ignorespaces}
\def\eql@punct@main@setrelax{\let\eql@punct@main\relax\ignorespaces}
\def\eqnpunct{\eql@ifstar@tight\eql@punct@next@setrelax\eql@punct@next@set}
\def\eql@punct@next@set#1{%
  \ifmmode
    \def\eql@punct@col{#1}%
    \def\eql@punct@line{#1}%
    \def\eql@punct@block{#1}%
  \else
    \eqnaddopt{punct={#1}}%
  \fi
  \ignorespaces}
\def\eql@punct@next@setrelax{%
  \ifmmode
    \let\eql@punct@block\relax
  \else
    \eqnaddopt{punct*}%
  \fi
  \ignorespaces}
\def\eql@punct@apply@col{%
  \ifx\eql@punct@col\@empty\else
    \eql@punct@sep
    \eql@punct@col
    \let\eql@punct@col\@empty
  \fi
}
\def\eql@punct@apply@line{%
  \ifx\eql@punct@line\relax
  \else
    \ifx\eql@punct@line\@empty\else
      \eql@punct@sep
      \eql@punct@line
    \fi
    \let\eql@punct@line\relax
    \let\eql@punct@col\@empty
  \fi
}
\def\eql@punct@apply@block{%
  \ifx\eql@punct@block\relax
  \else
    \ifx\eql@punct@block\@empty\else
      \eql@punct@sep
      \eql@punct@block
    \fi
    \let\eql@punct@block\relax
    \let\eql@punct@line\relax
    \let\eql@punct@col\@empty
  \fi
}
\let\eqnpunctapply\eql@punct@apply@block
\def\eql@class@innerright@sel@{%
  \ifdim\eql@fieldwidth@=\z@
    \eql@class@innerlead
  \else
    \eql@class@innerright
  \fi
}
\def\eql@class@innerleft@set#1{%
  \def\eql@class@innerleft{#1}%
}
\def\eql@class@innerright@set#1{%
  \def\eql@class@innerright{#1}%
  \let\eql@class@innerright@sel\eql@class@innerright
}
\def\eql@class@innerlead@set#1{%
  \def\eql@class@innerlead{#1}%
  \let\eql@class@innerright@sel\eql@class@innerright@sel@
}
\def\eql@class@ampeq{%
  \eql@class@innerleft@set{}%
  \eql@class@innerright@set{{}}%
}
\def\eql@class@eqamp{%
  \eql@class@innerleft@set{\mathrel{}}%
  \eql@class@innerright@set{\mathrel{}}%
  \eql@class@innerlead@set{{}}%
}
\eql@class@ampeq
\def\eql@tag@setbox@#1{%
  \def\eql@tag@box##1{#1}%
}
\def\eql@tag@setbox#1{%
  \def\eql@tag@box##1{\hbox{\m@th\normalfont#1}}%
}
\def\eql@tag@setform@#1{%
  \def\eql@tag@form##1{#1}%
}
\def\eql@tag@setform#1#2#3{%
  \def\eql@tag@form##1{#1\ignorespaces#2\unskip\@@italiccorr#3}%
}
\eql@tag@setbox{#1}
\eql@tag@setform({#1})
\def\eql@tag@boxedform#1{\eql@tag@box{\eql@tag@form{#1}}}
\DeclareRobustCommand{\tagform}{\eql@tag@form}
\DeclareRobustCommand{\tagbox}{\eql@tag@box}
\DeclareRobustCommand{\tagboxed}{\eql@tag@boxedform}
\DeclareRobustCommand{\eql@eqref}[1]{\textup{\eql@tag@boxedform{\ref{#1}}}}
\newdimen\eql@raisetag@amount@
\def\eql@raisetag@default{%
  \eql@warning{\string\raisetag\space not allowed here}
  \@gobble
}
\eql@amsmath@let\raisetag\eql@raisetag@default
\def\eql@raisetag#1{\global\eql@raisetag@amount@\glueexpr#1\relax}
\let\eql@raisetag@gobble\@gobble
\let\eql@SK@loaded\eql@false
\let\eql@SK@label\@gobble
\let\eql@SK@clearlabel\@empty
\let\eql@SK@setlabel\@gobble
\let\eql@SK@printlabel@right\@empty
\let\eql@SK@printlabel@left\@empty
\let\eql@SK@printlabel@line\@empty
\def\eql@label@clean{\eql@label@org}
\AddToHook{package/showkeys/after}{
  \let\eql@SK@loaded\eql@true
  \def\eql@SK@label#1{\SK@\SK@@label#1}
  \def\eql@SK@clearlabel{\let\eql@SK@lab\relax}
  \eql@SK@clearlabel
  \def\eql@SK@@label#1>#2\SK@{%
    \def\eql@SK@lab{\smash{\SK@labelcolor\showkeyslabelformat{#2}}}%
  }
  \def\eql@SK@setlabel#1{\SK@\eql@SK@@label#1}
  \def\eql@SK@printlabel@right{%
    \ifx\eql@SK@lab\relax\else
      \rlap{\kern\marginparsep\eql@SK@lab}%
      \eql@SK@clearlabel
    \fi
  }
  \def\eql@SK@printlabel@left{%
    \ifx\eql@SK@lab\relax\else
      \llap{\eql@SK@lab\kern\marginparsep}%
      \eql@SK@clearlabel
    \fi
  }
  \def\eql@SK@printlabel@line{%
    \ifx\eql@SK@lab\relax\else
      \dimen@\prevdepth
      \nointerlineskip
      \ifdefined\eql@tagsleft
        \llap{%
          \eql@SK@lab
          \kern\marginparsep
        }%
        \eql@SK@clearlabel
      \else
        \rlap{%
          \dimen@\displaywidth
          \advance\dimen@\marginparsep
          \kern\dimen@
          \eql@SK@lab
        }%
      \fi
      \eql@SK@clearlabel
      \prevdepth\dimen@
    \fi
  }
  \let\eql@label@org\label
  \def\eql@label@clean{\let\SK@\@gobbletwo\eql@label@org}
}
\let\eql@nextlabel\@undefined
\def\eql@labelname@default{[equation]}
\let\eql@label@org\label
\let\eql@nexttag\@undefined
\def\eql@tag@default{%
  \eql@error{\string\tag\space not allowed here}{}\eql@tag@gobble}
\let\tag\eql@tag@default
\def\eql@tag@gobble@[#1]#2{}
\def\eql@tag@gobble{%
  \eql@ampprotecttwo\eql@teststaropt@tight\eql@tag@gobble@\eql@tag@gobble@{}}
\let\eql@Hy@anchor\@gobble
\AddToHook{package/hyperref/after}{
  \def\eql@Hy@anchor#1{%
    \Hy@raisedlink{\hyper@anchor{#1}}%
  }%
}
\def\eql@tag@makenext{%
  \eql@ampprotecttwo\eql@teststaropt@tight
    \eql@tag@makenext@star\eql@tag@makenext@\eql@tag@text
}
\def\eql@tag@makenext@star[#1]#2{%
  \global\def\eql@nexttag{%
    \let\eql@tag@tool\@firstofone
    \protected@edef\eql@tag@text{#2}%
    \protected@edef\eql@tag@label{#1}%
  }%
}
\def\eql@tag@makenext@[#1]#2{%
  \global\def\eql@nexttag{%
    \let\eql@tag@tool\eql@tag@form
    \protected@edef\eql@tag@text{#2}%
    \protected@edef\eql@tag@label{#1}%
    \protected@edef\eql@tag@label{\p@equation\eql@tag@label}%
  }%
}
\newcount\eql@numbering@refcount@
\eql@numbering@refcount@\z@
\def\eql@numbering@ref{equation.eql-\the\eql@numbering@refcount@}
\def\eql@numbering@refstep{\global\advance\eql@numbering@refcount@\@ne}
\def\eql@numbering@makeblockanchor{%
  \eql@numbering@refstep
  \global\edef\eql@label@currentHref{\eql@numbering@ref}%
  \eql@Hy@anchor\eql@label@currentHref
  \global\edef\eql@label@thepage{\thepage}%
}
\def\eql@numbering@setblockanchor{%
  \let\thepage\eql@label@thepage
  \let\@currentHref\eql@label@currentHref
}
\def\eql@compose@anchor{%
  \ifdefined\eql@nexttag
    \eql@nexttag
    \def\@currentcounter{equation}%
    \let\@currentlabel\eql@tag@label
    \eql@numbering@refstep
    \edef\@currentHref{\eql@numbering@ref}%
    \eql@Hy@anchor\@currentHref
    \global\let\eql@nexttag\@undefined
  \else
    \refstepcounter{equation}%
    \let\eql@tag@tool\eql@tag@form
    \edef\eql@tag@text{\theequation}%
  \fi
}
\def\eql@compose@label{%
  \ifmeasuring@\else
    \eql@SK@clearlabel
    \ifdefined\eql@nextlabel
      \ifnum
        \ifnum\eql@numbering@target@<\z@
          \eql@row@
        \else
          \eql@numbering@target@
        \fi=\eql@row@
        \eql@compose@label@
      \fi
    \fi
  \fi
}
\def\eql@compose@label@{%
  \eql@SK@setlabel\eql@nextlabel
  \begingroup
    \ifnum\eql@numbering@target@=\eql@row@
      \eql@numbering@setblockanchor
    \fi
    \let\@currentlabelname\eql@labelname@default
    \expandafter\eql@label@clean\expandafter{\eql@nextlabel}%
    \global\let\eql@nextlabel\@undefined
  \endgroup
}
\def\eql@compose@tag{%
  \eql@tagging@tagbegin
  \eql@tag@box{%
    \eql@tag@tool\eql@tag@text
    \eql@tagging@tagsave
  }%
  \eql@tagging@tagend
}
\def\eql@compose@print{%
  \eql@compose@anchor
  \eql@compose@label
  \ifdefined\eql@tagsleft
    \eql@SK@printlabel@left
    \eql@compose@tag
  \else
    \eql@compose@tag
    \eql@SK@printlabel@right
  \fi
}
\def\eql@compose@measure{%
  \ifdefined\eql@nexttag
    \eql@nexttag
    \eql@tag@box{\eql@tag@tool\eql@tag@text}%
  \else
    \stepcounter{equation}%
    \eql@tag@box{\eql@tag@form\theequation}%
  \fi
  \ifnum\eql@numbering@target@<\z@
    \global\let\eql@nextlabel\@undefined
    \global\let\eql@nexttag\@undefined
  \fi
}
\def\eql@tagbox@make#1{%
  \setbox\eql@tagbox@\hbox{\eql@strut@tag\@lign#1}%
  \eql@tagwidth@\wd\eql@tagbox@
  \ifdim\eql@tagwidth@<\eql@tagwidthmin@
    \eql@tagwidth@\eql@tagwidthmin@
  \fi
  \advance\eql@tagwidth@\eql@tagsepmin@
}
\def\eql@tagbox@print@tagsright{%
  \kern-\wd\eql@tagbox@
  \box\eql@tagbox@
}
\def\eql@tagbox@print@tagsleft{%
  \wd\eql@tagbox@\z@
  \box\eql@tagbox@
}
\def\eql@tagbox@print@tagsright@raise{%
  \ifnum\eql@row@=\eql@totalrows@
    \global\advance\eql@raisetag@firstlast@\tw@
  \fi
  \llap{\vtop{%
    \vskip-\eql@raisetag@amount@
    \normalbaselines
    \setbox\@ne\hbox{}%
    \dp\@ne\eql@line@depth@
    \box\@ne
    \box\eql@tagbox@
  }}%
}
\def\eql@tagbox@print@tagsleft@raise{%
  \ifnum\eql@row@=\@ne
    \global\advance\eql@raisetag@firstlast@\@ne
  \fi
  \rlap{\vbox{%
    \normalbaselines
    \box\eql@tagbox@
    \vbox to\eql@line@height@{}%
    \vskip\eql@raisetag@amount@
  }}%
}
\def\eql@numbering@printsubeqlabel{%
  \ifdefined\eql@parentlabel
    \eql@numbering@makeblockanchor
    \eql@SK@setlabel\eql@parentlabel
    \begingroup
      \def\@currentcounter{equation}%
      \eql@numbering@setblockanchor
      \let\@currentlabelname\eql@labelname@default
      \protected@edef\@currentlabel{\p@equation\theparentequation}%
      \expandafter\eql@label@clean\expandafter{\eql@parentlabel}%
    \endgroup
    \eql@SK@printlabel@line
  \fi
}
\def\eql@numbering@tab@first{first}
\def\eql@numbering@tab@last{last}
\def\eql@numbering@tab@middle{middle}
\def\eql@numbering@tab@here{here}
\def\eql@numbering@tab@in{in}
\def\eql@numbering@tab@out{out}
\def\eql@numbering@tab@sub{sub}
\def\eql@numbering@tab@all{all}
\def\eql@numbering@tab@none{none}
\let\eql@numbering@tab@f\eql@numbering@tab@first
\let\eql@numbering@tab@l\eql@numbering@tab@last
\let\eql@numbering@tab@m\eql@numbering@tab@middle
\let\eql@numbering@tab@mid\eql@numbering@tab@middle
\let\eql@numbering@tab@o\eql@numbering@tab@out
\let\eql@numbering@tab@outside\eql@numbering@tab@out
\let\eql@numbering@tab@i\eql@numbering@tab@in
\let\eql@numbering@tab@inside\eql@numbering@tab@in
\let\eql@numbering@tab@within\eql@numbering@tab@in
\let\eql@numbering@tab@h\eql@numbering@tab@here
\let\eql@numbering@tab@s\eql@numbering@tab@sub
\let\eql@numbering@tab@subeq\eql@numbering@tab@sub
\let\eql@numbering@tab@subequation\eql@numbering@tab@sub
\let\eql@numbering@tab@subequations\eql@numbering@tab@sub
\let\eql@numbering@tab@a\eql@numbering@tab@all
\let\eql@numbering@tab@n\eql@numbering@tab@none
\expandafter\let\csname eql@numbering@tab@!\endcsname\eql@numbering@tab@all
\expandafter\let\csname eql@numbering@tab@*\endcsname\eql@numbering@tab@none
\expandafter\let\csname eql@numbering@tab@1\endcsname\eql@numbering@tab@first
\let\eql@numbering@mode\eql@numbering@tab@all
\def\eql@numbering@set#1{%
  \ifcsname eql@numbering@tab@#1\endcsname
    \expandafter\let\expandafter\eql@numbering@mode
      \csname eql@numbering@tab@#1\endcsname
    \ifx\eql@numbering@mode\eql@numbering@tab@none
      \let\eql@numbering@mode\eql@numbering@tab@all
      \let\eql@numbering@active\eql@false
    \fi
  \else
    \eql@error{numbering mode `#1' unknown: setting to `all'}%
    \let\eql@numbering@mode\eql@numbering@tab@all
  \fi
}
\let\eql@numbering@active\eql@true
\newcount\eql@numbering@target@
\def\eql@numbering@mode@all{%
  \eql@numbering@target@\m@ne}
\def\eql@numbering@mode@sub{%
  \eql@numbering@target@\m@ne
  \let\eql@numbering@subeq@use\eql@true}
\def\eql@numbering@mode@first{%
  \eql@numbering@target@\@ne}
\def\eql@numbering@mode@last{%
  \eql@numbering@target@\@MM}
\def\eql@numbering@mode@here{%
  \eql@numbering@target@\z@}
\def\eql@numbering@mode@in{%
  \ifdefined\eql@tagsleft
    \eql@numbering@mode@last
  \else
    \eql@numbering@mode@first
  \fi
}
\def\eql@numbering@mode@out{%
  \ifdefined\eql@tagsleft
    \eql@numbering@mode@first
  \else
    \eql@numbering@mode@last
  \fi
}
\def\eql@numbering@mode@middle{%
  \eql@numbering@target@\z@
  \let\eql@numbering@eval@target\eql@numbering@eval@middle}
\def\eql@numbering@eval@middle{%
  \ifnum\eql@numbering@target@=\z@
    \count@\eql@row@
    \advance\count@\@ne
    \divide\count@\tw@
    \global\eql@numbering@target@\count@
  \fi
}
\def\eql@numbering@eval@mode{%
  \let\eql@numbering@eval@target\@undefined
  \let\eql@numbering@subeq@use\eql@false
  \csname eql@numbering@mode@\eql@numbering@mode\endcsname
  \ifdefined\eql@numbering@active
    \let\eql@numbering@eqnswinit\@eqnswtrue
  \else
    \let\eql@numbering@eqnswinit\@eqnswfalse
  \fi
  \let\eql@numbering@active\eql@false
}
\def\numberhere{%
  \ifnum\eql@numbering@target@<\z@
    \donumber
  \else
    \ifmeasuring@
      \global\eql@numbering@target@\eql@row@
    \fi
  \fi
}
\def\numbernext{%
  \ifnum\eql@numbering@target@<\z@
    \nonumber
  \else
    \ifmeasuring@
      \ifnum\eql@numbering@target@=\eql@row@
        \global\advance\eql@numbering@target@\@ne
      \fi
    \fi
  \fi
}
\let\eql@numbering@autolabel\eql@false
\let\eql@numbering@autotag\eql@true
\let\eql@numbering@blocklabel\@undefined
\let\eql@numbering@blocktag\@undefined
\let\eql@numbering@warn\eql@true
\def\eql@numbering@autoenable{%
  \global\@eqnswtrue
  \ifx\eql@numbering@mode\eql@numbering@tab@here
    \ifnum\eql@numbering@target@=\z@
      \numberhere
    \fi
  \fi
}
\eql@amsmath@after{
  \let\eql@print@eqnum@default\print@eqnum
  \let\eql@incr@eqnum@default\incr@eqnum
}
\def\donumber{%
  \if@eqnsw\else
    \global\@eqnswtrue
    \ifx\print@eqn\@empty
      \global\let\print@eqn\eql@print@eqnum@default
    \fi
    \ifx\incr@eqn\@empty
      \global\let\incr@eqn\eql@incr@eqnum@default
    \fi
  \fi
}
\def\eql@label{%
  \ifdefined\eql@numbering@autolabel
    \eql@numbering@autoenable
  \fi
  \ifdefined\eql@numbering@warn
    \ifdefined\eql@nextlabel
      \eql@warn@label@multiple\eql@nextlabel
    \fi
  \fi
  \global\edef\eql@nextlabel
}
\let\eql@label@gobble\@gobble
\def\eql@tag{%
  \ifdefined\eql@numbering@autotag
    \eql@numbering@autoenable
  \fi
  \ifdefined\eql@numbering@warn
    \ifdefined\eql@nexttag
      \eql@warn@tag@multiple
    \fi
  \fi
  \eql@tag@makenext
}
\def\eql@blocklabel@set#1{%
  \ifdefined\eql@blocklabel
    \eql@warn@label@multiple\eql@blocklabel
  \fi
  \edef\eql@blocklabel{#1}%
}
\def\eql@blocktag@set#1{%
  \ifdefined\eql@blocktag
    \eql@warn@tag@multiple
  \fi
  \def\eql@blocktag{{#1}}%
}
\def\eql@blocktag@setstar#1{%
  \ifdefined\eql@blocktag
    \eql@warn@tag@multiple
  \fi
  \def\eql@blocktag{*{#1}}%
}
\def\eql@numbering@single@init{%
  \let\eql@numbering@warn\eql@true
  \let\label\eql@label
  \let\tag\eql@tag
  \let\raisetag\eql@raisetag
  \eql@numbering@target@\m@ne
  \let\eql@nextlabel\eql@blocklabel
  \ifdefined\eql@blocktag
    \expandafter\eql@tag@makenext\eql@blocktag
  \else
    \let\eql@nexttag\@undefined
  \fi
  \eql@numbering@eqnswinit
  \ifdefined\eql@numbering@autolabel
    \ifdefined\eql@nextlabel
      \@eqnswtrue
    \fi
  \fi
  \ifdefined\eql@numbering@autotag
    \ifdefined\eql@nexttag
      \@eqnswtrue
    \fi
  \fi
  \global\eql@raisetag@amount@\z@
}
\def\eql@numbering@measure@init{%
  \let\eql@numbering@warn\eql@true
  \let\label\eql@label
  \let\tag\eql@tag
  \let\raisetag\eql@raisetag
  \global\let\eql@nextlabel\eql@blocklabel
  \ifdefined\eql@blocktag
    \expandafter\eql@tag@makenext\eql@blocktag
  \else
    \global\let\eql@nexttag\@undefined
  \fi
  \ifnum\eql@numbering@target@<\z@\else
    \eql@numbering@eqnswinit
    \ifdefined\eql@numbering@autolabel
      \ifdefined\eql@nextlabel
        \@eqnswtrue
      \fi
    \fi
  \fi
}
\def\eql@numbering@measure@line@begin{%
  \ifnum\eql@numbering@target@<\z@
    \global\eql@numbering@eqnswinit
  \fi
}
\def\eql@numbering@measure@eval{%
  \ifdefined\eql@numbering@eval@target
    \eql@numbering@eval@target
  \fi
  \ifnum\eql@numbering@target@>\eql@row@
    \global\eql@numbering@target@\eql@row@
  \fi
  \ifnum\eql@numbering@target@>\z@
    \if@eqnsw\else
      \global\eql@numbering@target@\z@
    \fi
  \fi
  \ifnum\eql@numbering@target@<\@ne
    \ifdefined\eql@nextlabel
      \eql@warn@label@unused
      \global\let\eql@nextlabel\@undefined
    \fi
    \ifdefined\eql@nexttag
      \eql@warn@tag@unused
      \global\let\eql@nexttag\@undefined
    \fi
  \fi
}
\def\eql@numbering@print@init{%
  \ifnum\eql@numbering@target@<\z@
    \let\eql@numbering@warn\eql@false
    \let\label\eql@label
    \let\tag\eql@tag
    \let\raisetag\eql@raisetag
    \let\eql@nextlabel\eql@blocklabel
    \ifdefined\eql@blocktag
      \expandafter\eql@tag@makenext\eql@blocktag
    \else
      \let\eql@nexttag\@undefined
    \fi
  \else
    \let\label\eql@label@gobble
    \let\tag\eql@tag@gobble
    \let\raisetag\eql@raisetag@gobble
  \fi
}
\def\eql@numbering@print@block@begin{%
  \ifnum\eql@numbering@target@>\z@
    \eql@numbering@makeblockanchor
  \fi
  \ifdefined\eql@numbering@subeq@use
    \eql@numbering@printsubeqlabel
  \fi
}
\def\eql@numbering@print@line@begin{%
  \ifnum\eql@numbering@target@<\z@
    \global\eql@numbering@eqnswinit
    \global\eql@raisetag@amount@\z@
  \fi
}
\def\eql@numbering@print@line@eval{%
  \ifnum\eql@numbering@target@<\z@\else
    \ifnum\eql@numbering@target@=\eql@row@
      \global\@eqnswtrue
    \else
      \global\@eqnswfalse
    \fi
  \fi
}
\eql@amsmath@undefine\c@parentequation
\eql@amsmath@undefine\theparentequation
\ifdefined\c@parentequation\else
\newcounter{parentequation}
\fi
\def\eql@subequations@template{\theparentequation\alph{equation}}
\let\eql@subequations@active\eql@false
\def\eql@subequations@init{%
  \edef\eql@subequations@restorecounter{%
    \global\c@equation\the\c@equation\relax}%
  \ifdefined\eql@blocktag
    \expandafter\eql@tag@makenext\eql@blocktag
    \eql@nexttag
    \eql@numbering@refstep
    \protected@edef\theHparentequation{\eql@numbering@ref}%
    \protected@edef\theparentequation{\eql@tag@text}%
  \else
    \advance\c@equation\@ne
    \protected@edef\theparentequation{\theequation}%
    \ifdefined\theHequation
      \protected@edef\theHparentequation{\theHequation}%
    \fi
  \fi
  \global\c@parentequation\c@equation
  \global\c@equation\z@
  \let\theequation\eql@subequations@template
  \def\theHequation{\theHparentequation.\arabic{equation}}%
}
\def\eql@subequations@close{%
  \ifnum\c@equation=\z@
    \eql@subequations@restorecounter
  \else
    \global\c@equation\c@parentequation
  \fi
}
\def\eql@subequations@start{%
  \let\eql@blocktag\@undefined
  \let\eql@blocklabel\@undefined
  \eql@nextopt@process{subequations}%
  \eql@subequations@init
  \eql@numbering@refstep
  \edef\eql@subequations@currentHref{\eql@numbering@ref}%
  \eql@Hy@anchor\eql@subequations@currentHref
  \edef\eql@subequations@thepage{\thepage}%
  \def\@currentcounter{equation}%
  \let\@currentHref\eql@subequations@currentHref
  \protected@edef\@currentlabel{\p@equation\theparentequation}%
  \let\@currentlabelname\eql@labelname@default
  \let\eql@subequations@active\eql@true
  \ifdefined\eql@blocklabel
    \eql@SK@label\eql@blocklabel
  \fi
  \ignorespaces
}
\def\eql@subequations@end{%
  \ifnum\c@equation>\z@
    \ifdefined\eql@blocklabel
      \begingroup
        \def\@currentcounter{equation}%
        \let\thepage\eql@subequations@thepage
        \let\@currentHref\eql@subequations@currentHref
        \protected@edef\@currentlabel{\p@equation\theparentequation}%
        \let\@currentlabelname\eql@labelname@default
        \expandafter\eql@label@clean\expandafter{\eql@blocklabel}%
      \endgroup
    \fi
  \fi
  \eql@subequations@close
  \ignorespacesafterend
}
\newenvironment{eql@subequations}{%
  \eql@subequations@testall\eql@subequations@start%
}{%
  \eql@subequations@end
}
\def\eql@subequations@testall{\eql@subequations@testopt}
\def\eql@subequations@testopt#1{%
  \eql@ifnextchar@tight[%]
    {\eql@subequations@addopt{\eql@subequations@testat{#1}}}%
    {\eql@subequations@testat{#1}}}
\def\eql@subequations@addopt#1[#2]{\eqnaddopt{#2}#1}
\def\eql@subequations@testat#1{%
  \eql@ifat@tight%
    {\eql@subequations@addlabel{#1}}%
    {#1}}
\def\eql@subequations@addlabel#1#2{\eqnaddopt{label={#2}}#1}
\def\eql@numbering@subeq@init{%
  \let\eql@save@theequation\theequation
  \let\eql@save@theHequation\theHequation
  \eql@subequations@init
  \let\eql@parentlabel\eql@blocklabel
  \let\eql@parenttag\eql@blocktag
  \let\eql@blocklabel\@undefined
  \let\eql@blocktag\@undefined
}
\def\eql@numbering@subeq@test{%
  \ifnum\c@equation<\tw@
    \let\eql@numbering@subeq@use\@ne
  \fi
}
\def\eql@numbering@subeq@revert{%
  \let\eql@blocklabel\eql@parentlabel
  \let\eql@blocktag\eql@parenttag
  \let\eql@numbering@subeq@use\eql@false
  \let\theequation\eql@save@theequation
  \let\theHequation\eql@save@theHequation
  \eql@subequations@restorecounter
}
\def\eql@numbering@subeq@close{%
  \eql@subequations@close
}
\interdisplaylinepenalty\@M
\def\eql@getdsp@pen#1{%
  \ifcase #1\@M \or 9999 \or 6999 \or 2999 \or \z@\fi
}
\DeclareRobustCommand{\eql@displaybreak@default}[1][4]{%
  \eql@warning{Invalid use of \string\displaybreak}{}}
\eql@amsmath@after{\let\eql@displaybreak@default\displaybreak}
\eql@amsmath@let\displaybreak\eql@displaybreak@default
\newcount\eql@displaybreak@pen@
\newcount\eql@displaybreak@prepen@
\protected\def\eql@displaybreak@print{%
  \eql@ampprotect\eql@testopt@tight\eql@displaybreak@print@{4}%
}
\def\eql@displaybreak@print@[#1]{%
  \ifnum#1<\z@
    \global\eql@displaybreak@pen@\@MM
  \else
    \global\eql@displaybreak@pen@-\@getpen{#1}\relax
  \fi
}
\def\eql@displaybreak@pre#1{%
  \ifnum#1<\z@
    \global\eql@displaybreak@prepen@\@MM
  \else
    \global\eql@displaybreak@prepen@-\@getpen{#1}\relax
  \fi
}
\protected\def\eql@displaybreak@measure{%
  \eql@ampprotect\eql@testopt@tight\eql@displaybreak@measure@{4}%
}
\def\eql@displaybreak@measure@[#1]{}
\newskip\eql@vspaceskip@
\newskip\eql@abovespace@
\newskip\eql@belowspace@
\let\eql@vspace@org\vspace
\def\eql@vspace{\eql@ifstar@loose\eql@vspace@\eql@vspace@}
\def\eql@vspace@#1{%
  \global\advance\eql@vspaceskip@\glueexpr#1\relax}
\def\eql@display@init{%
  \eql@display@firstavail@\z@
  \eql@raisetag@firstlast@\z@
  \let\displaybreak\eql@displaybreak@print
  \eql@displaybreak@pen@\@MM
  \eql@vspaceskip@\z@skip
  \let\eql@vspace@org\vspace
  \let\vspace\eql@vspace
}
\def\eql@display@close{%
  \ifdefined\eql@tagging@on
    \ifdefined\dollardollar@begin\else
      \belowdisplayskip-\belowdisplayskip
      \belowdisplayshortskip-\belowdisplayshortskip
    \fi
  \fi
  \ifdim\eql@display@firstavail@<\z@
    \eql@display@firstavail@\z@
  \fi
  \eql@skip@mode@leave@\z@
  \ifdim\eql@halign@prevdepth@=\maxdimen
    \ifdim\predisplaysize=-\maxdimen
      \eql@skip@mode@above@\eql@skip@mode@cont@above\relax
      \eql@skip@mode@below@\eql@skip@mode@cont@below\relax
    \else
      \eql@skip@mode@above@\z@
      \eql@skip@mode@below@\z@
      \advance\eql@display@firstavail@\displayindent
      \ifdim\eql@display@firstavail@>\predisplaysize
        \ifcase\eql@skip@mode@short\relax
        \or
          \eql@skip@mode@above@\@ne
        \or
          \eql@skip@mode@above@\@ne
          \ifnum\eql@totalrows@=\@ne
            \eql@skip@mode@below@\@ne
          \fi
        \or
          \eql@skip@mode@above@\@ne
          \eql@skip@mode@below@\@ne
        \fi
      \fi
    \fi
  \else
    \ifdim\eql@halign@prevdepth@=-\@m\p@
      \eql@skip@mode@above@\eql@skip@mode@top@above\relax
      \eql@skip@mode@below@\eql@skip@mode@top@below\relax
    \else
      \eql@skip@mode@above@\eql@skip@mode@par@above\relax
      \eql@skip@mode@below@\eql@skip@mode@par@below\relax
    \fi
  \fi
  \ifcase\eql@skip@mode@above@
  \or\or\or
    \predisplaypenalty\z@
  \or
    \predisplaypenalty\z@
  \fi
  \ifcase\eql@skip@mode@below@
  \or\or\or
    \eql@skip@mode@leave@\@ne
  \or
    \eql@skip@mode@leave@\tw@
  \fi
  \ifdefined\eql@skip@force@above
    \eql@skip@mode@above@\eql@skip@force@above\relax
  \fi
  \ifdefined\eql@skip@force@below
    \eql@skip@mode@below@\eql@skip@force@below\relax
  \fi
  \ifdefined\eql@skip@force@leave
    \eql@skip@mode@leave@\eql@skip@force@leave\relax
  \fi
  \ifnum\eql@skip@mode@leave@>\z@
    \postdisplaypenalty\z@
  \fi
  \ifodd\eql@raisetag@firstlast@
    \ifcase\eql@skip@mode@above@
      \abovedisplayskip\glueexpr\eql@skip@tag@above\relax
    \or
      \abovedisplayskip\glueexpr\eql@skip@tag@above\relax
    \or
      \abovedisplayskip\glueexpr\eql@skip@tag@above\relax
    \or
      \abovedisplayskip\glueexpr\eql@skip@partag@above\relax
    \or
      \abovedisplayskip\glueexpr\eql@skip@partag@above\relax
    \or
      \abovedisplayskip\z@skip
    \or
      \abovedisplayskip\glueexpr\eql@skip@medtag@above\relax
    \or
      \abovedisplayskip\glueexpr\eql@skip@custom@above\relax
    \fi
  \else
    \ifcase\eql@skip@mode@above@
      \abovedisplayskip\glueexpr\eql@skip@long@above\relax
    \or
      \abovedisplayskip\glueexpr\eql@skip@short@above\relax
    \or
      \abovedisplayskip\glueexpr\eql@skip@cont@above\relax
    \or
      \abovedisplayskip\glueexpr\eql@skip@par@above\relax
    \or
      \abovedisplayskip\glueexpr\eql@skip@top@above\relax
    \or
      \abovedisplayskip\z@skip
    \or
      \abovedisplayskip\glueexpr\eql@skip@med@above\relax
    \or
      \abovedisplayskip\glueexpr\eql@skip@custom@above\relax
    \fi
  \fi
  \ifnum\eql@raisetag@firstlast@>\@ne
    \ifcase\eql@skip@mode@below@
      \belowdisplayskip\glueexpr\eql@skip@tag@below\relax
    \or
      \belowdisplayskip\glueexpr\eql@skip@tag@below\relax
    \or
      \belowdisplayskip\glueexpr\eql@skip@tag@below\relax
    \or
      \belowdisplayskip\glueexpr\eql@skip@partag@below\relax
    \or
      \belowdisplayskip\glueexpr\eql@skip@partag@below\relax
    \or
      \belowdisplayskip\z@skip
    \or
      \belowdisplayskip\glueexpr\eql@skip@medtag@below\relax
    \or
      \belowdisplayskip\glueexpr\eql@skip@custom@below\relax
    \fi
  \else
    \ifcase\eql@skip@mode@below@
      \belowdisplayskip\glueexpr\eql@skip@long@below\relax
    \or
      \belowdisplayskip\glueexpr\eql@skip@short@below\relax
    \or
      \belowdisplayskip\glueexpr\eql@skip@cont@below\relax
    \or
      \belowdisplayskip\glueexpr\eql@skip@par@below\relax
    \or
      \belowdisplayskip\glueexpr\eql@skip@top@below\relax
    \or
      \belowdisplayskip\z@skip
    \or
      \belowdisplayskip\glueexpr\eql@skip@med@below\relax
    \or
      \belowdisplayskip\glueexpr\eql@skip@custom@below\relax
    \fi
  \fi
  \ifnum\eql@displaybreak@pen@=\@MM\else
    \postdisplaypenalty\eql@displaybreak@pen@
  \fi
  \ifnum\eql@displaybreak@prepen@=\@MM\else
    \predisplaypenalty\eql@displaybreak@prepen@
  \fi
  \advance\abovedisplayskip\eql@abovespace@
  \advance\belowdisplayskip\eql@belowspace@
  \advance\belowdisplayskip\eql@vspaceskip@
  \count@\prevgraf
  \advance\count@\eql@totalrows@
  \ifnum\count@>\z@
    \advance\count@\m@ne
  \fi
  \prevgraf\count@
  \global\eql@skip@mode@leave@\eql@skip@mode@leave@
  \ifdefined\eql@tagging@on
    \ifdefined\dollardollar@begin\else
      \belowdisplayskip-\belowdisplayskip
    \fi
  \fi
}
\def\eql@display@leave{%
  \let\label\eql@label@org
  \let\tag\eql@tag@default
  \let\raisetag\eql@raisetag@default
  \let\displaybreak\eql@displaybreak@default
  \let\intertext\eql@intertext@default
  \let\vspace\eql@vspace@org
}
\expandafter\def\expandafter\@arrayparboxrestore\expandafter{%
  \@arrayparboxrestore
  \eql@display@leave
  \ifdefined\eql@ampproof@active
    \eql@amprevert
  \fi
  \@displayfalse
}
\newbox\eql@strutbox@
\def\eql@strut{\copy\eql@strutbox@}
\let\eql@strut@field\eql@strut
\let\eql@strut@tag\eql@strut
\def\eql@strut@make{%
  \setbox\eql@strutbox@\hbox{%
    \@tempdima\normalbaselineskip
    \advance\@tempdima-\normallineskiplimit
    \@tempdimb.3\normalbaselineskip
    \advance\@tempdimb.5\normallineskiplimit
    \advance\@tempdima-\@tempdimb
    \vrule\@height\@tempdima\@depth\@tempdimb\@width\z@
  }
}
\AtBeginDocument{\eql@strut@make}
\def\eql@halign@spread{%
  \eql@spread@\glueexpr\eql@spread@val\relax
  \advance\eql@spread@\normalbaselineskip
  \advance\eql@spread@-\baselineskip
  \ifdim\eql@spread@>\z@
    \openup\eql@spread@
    \ifdefined\spread@equation
      \let\spread@equation\@empty
    \fi
  \fi
}
\newdimen\eql@halign@prevdepth@
\def\eql@halign@catchprevdepth{%
  \ifvmode
    \eql@halign@prevdepth@\prevdepth
    \nointerlineskip
    \noindent
  \else
    \eql@halign@prevdepth@\maxdimen
  \fi
}
\def\eql@halign@leave{%
  \ifcase\eql@skip@mode@leave@
  \or
    \endgraf
  \or
    \endgraf
    \prevdepth-\@m\p@
  \fi
}
\def\eql@halign@before{%
  \ifdim\eql@halign@prevdepth@=\maxdimen\else
    \prevdepth\eql@halign@prevdepth@
  \fi
  \ifdim\prevdepth=-\@m\p@\else
    \ifdefined\eql@display@height
      \skip@\baselineskip
      \advance\skip@-\glueexpr\eql@display@height\relax
      \advance\skip@-\prevdepth\relax
      \ifdim\skip@<\lineskiplimit
        \skip@\lineskip
      \fi
      \advance\skip@-\eql@spread@\relax
      \vskip\skip@
      \nointerlineskip
    \else
      \vskip-\eql@spread@\relax
    \fi
  \fi
}
\def\eql@halign@after{%
  \ifdefined\eql@display@depth
    \prevdepth\glueexpr\eql@display@depth\relax
  \fi
}
\def\eql@halign@init#1{%
  \eql@halign@spread
  \eql@strut@make
  \everycr{\noalign{#1}}%
}
\def\eql@stack@enable{%
  \let\eql@stack@save@single\eql@stack@save@single@
  \let\eql@stack@save@multi\eql@stack@save@multi@
  \let\eql@stack@save@boxed\eql@stack@save@boxed@
}
\let\eql@stack@save@single\eql@stack@enable
\let\eql@stack@save@multi\eql@stack@enable
\let\eql@stack@save@boxed\eql@stack@enable
\let\eql@stack@restore\@empty
\def\eql@stack@save@reg#1{\global#1\the#1\relax}
\def\eql@stack@save@let#1#2{\global\let\noexpand#2\noexpand#1}
\def\eql@stack@save@single@{%
  \let\eql@stack@nextlabel\eql@nextlabel
  \let\eql@stack@nexttag\eql@nexttag
  \edef\eql@stack@restore{%
    \global\if@eqnsw\noexpand\@eqnswtrue\else\noexpand\@eqnswfalse\fi
    \eql@stack@save@let\eql@stack@nextlabel\eql@nextlabel
    \eql@stack@save@let\eql@stack@nexttag\eql@nexttag
    \eql@stack@save@reg\eql@displaybreak@pen@
    \eql@stack@save@reg\eql@vspaceskip@
    \eql@stack@save@reg\eql@shape@pos@
    \eql@stack@save@reg\eql@shape@amount@
    \eql@stack@save@reg\eql@display@firstavail@
    \eql@stack@save@reg\eql@raisetag@amount@
    \eql@stack@save@reg\eql@raisetag@firstlast@
  }%
}
\def\eql@stack@save@multi@{%
  \let\eql@stack@nextlabel\eql@nextlabel
  \let\eql@stack@nexttag\eql@nexttag
  \let\eql@stack@tagwidth@tab\eql@tagwidth@tab
  \let\eql@stack@fieldlength@tab\eql@fieldlength@tab
  \let\eql@stack@colwidth@tab\eql@colwidth@tab
  \let\eql@stack@label@thepage\eql@label@thepage
  \let\eql@stack@label@currentHref\eql@label@currentHref
  \edef\eql@stack@restore{%
    \global\if@eqnsw\noexpand\@eqnswtrue\else\noexpand\@eqnswfalse\fi
    \eql@stack@save@let\eql@stack@nextlabel\eql@nextlabel
    \eql@stack@save@let\eql@stack@nexttag\eql@nexttag
    \eql@stack@save@let\eql@stack@tagwidth@tab\eql@tagwidth@tab
    \eql@stack@save@let\eql@stack@fieldlength@tab\eql@fieldlength@tab
    \eql@stack@save@let\eql@stack@colwidth@tab\eql@colwidth@tab
    \eql@stack@save@let\eql@stack@label@thepage\eql@label@thepage
    \eql@stack@save@let\eql@stack@label@currentHref\eql@label@currentHref
    \eql@stack@save@reg\eql@displaybreak@pen@
    \eql@stack@save@reg\eql@vspaceskip@
    \eql@stack@save@reg\eql@shape@pos@
    \eql@stack@save@reg\eql@shape@amount@
    \eql@stack@save@reg\eql@display@firstavail@
    \eql@stack@save@reg\eql@raisetag@amount@
    \eql@stack@save@reg\eql@raisetag@firstlast@
    \eql@stack@save@reg\eql@column@
    \eql@stack@save@reg\eql@totalcolumns@
    \eql@stack@save@reg\eql@line@avail@
    \eql@stack@save@reg\eql@line@pos@
    \eql@stack@save@reg\eql@line@width@
    \eql@stack@save@reg\eql@line@depth@
    \eql@stack@save@reg\eql@line@height@
    \eql@stack@save@reg\eql@tagwidth@max@
    \eql@stack@save@reg\eql@numbering@target@
    \eql@stack@save@reg\eql@row@
    \eql@stack@save@reg\eql@tagrows@
  }%
}
\def\eql@stack@save@boxed@{%
  \edef\eql@stack@restore{%
    \eql@stack@save@reg\eql@row@
    \eql@stack@save@reg\eql@totalrows@
    \eql@stack@save@reg\eql@shape@pos@
    \eql@stack@save@reg\eql@shape@amount@
  }%
}
\ifdefined\inf@bad\else%
  \newcount\inf@bad
  \inf@bad1000000\relax
\fi
\let\eql@restore@hfuzz\@empty
\def\eql@save@hfuzz{\edef\eql@restore@hfuzz{\hfuzz\the\hfuzz\relax}}
\newcount\eql@shape@pos@
\newdimen\eql@shape@amount@
\newdimen\eql@marginleft@
\newdimen\eql@marginright@
\newcount\eql@marginbadness@
\newcount\eql@maxbadness@
\eql@marginbadness@\inf@bad
\eql@maxbadness@\inf@bad
\def\eql@shape@tab@default{default}
\def\eql@shape@tab@left{left}
\def\eql@shape@tab@center{center}
\def\eql@shape@tab@right{right}
\def\eql@shape@tab@first{first}
\def\eql@shape@tab@hanging{hanging}
\def\eql@shape@tab@steps{steps}
\let\eql@shape@tab@def\eql@shape@tab@default
\let\eql@shape@tab@\eql@shape@tab@default
\let\eql@shape@tab@l\eql@shape@tab@left
\let\eql@shape@tab@c\eql@shape@tab@center
\let\eql@shape@tab@r\eql@shape@tab@right
\let\eql@shape@tab@rc\eql@shape@tab@first
\let\eql@shape@tab@indent\eql@shape@tab@first
\let\eql@shape@tab@hang\eql@shape@tab@hanging
\let\eql@shape@tab@lc\eql@shape@tab@hanging
\let\eql@shape@tab@outdent\eql@shape@tab@hanging
\let\eql@shape@tab@lcr\eql@shape@tab@steps
\let\eql@shape@mode\eql@shape@tab@default
\def\eql@shape@set#1{%
  \ifcsname eql@shape@tab@#1\endcsname
    \expandafter\let\expandafter\eql@shape@mode
      \csname eql@shape@tab@#1\endcsname
  \else
    \eql@error{shape `#1' unknown: setting to default}%
    \let\eql@shape@mode\eql@shape@tab@default
  \fi
}
\def\eql@shape@layoutcenter@left{\eql@shape@pos@\z@\eql@shape@amount@\z@}
\def\eql@shape@layoutcenter@center{\eql@shape@pos@\@ne\eql@shape@amount@\z@}
\def\eql@shape@layoutcenter@right{\eql@shape@pos@\tw@\eql@shape@amount@\z@}
\let\eql@shape@layoutcenter@default\eql@shape@layoutcenter@center
\def\eql@shape@layoutleft@left{\eql@shape@pos@\z@\eql@shape@amount@\z@}
\def\eql@shape@layoutleft@center{\eql@shape@pos@\@ne\eql@shape@amount@\z@}
\def\eql@shape@layoutleft@right{\eql@shape@pos@\tw@\eql@shape@amount@\z@}
\let\eql@shape@layoutleft@default\eql@shape@layoutleft@left
\def\eql@shape@layoutcenter@first{%
  \eql@shape@pos@\z@
  \eql@shape@amount@\z@
  \ifnum\eql@totalrows@>\@ne
    \ifnum\eql@row@=\@ne
      \eql@shape@amount@\eql@indent@
    \fi
  \fi
}
\def\eql@shape@layoutleft@first{%
  \eql@shape@pos@\z@
  \eql@shape@amount@\z@
  \ifnum\eql@totalrows@>\@ne
    \ifnum\eql@row@=\@ne
      \eql@shape@amount@\eql@indent@
    \fi
  \fi
}
\def\eql@shape@layoutcenter@hanging{%
  \eql@shape@pos@\z@
  \eql@shape@amount@\eql@indent@
  \ifnum\eql@totalrows@>\@ne
    \ifnum\eql@row@=\@ne
      \eql@shape@amount@\z@
    \fi
  \fi
}
\def\eql@shape@layoutleft@hanging{%
  \eql@shape@pos@\z@
  \eql@shape@amount@\z@
  \ifnum\eql@totalrows@>\@ne
    \ifnum\eql@row@=\@ne
      \eql@shape@amount@-\eql@indent@
    \fi
  \fi
}
\def\eql@shape@layoutcenter@steps{%
  \eql@shape@amount@\z@
  \eql@shape@pos@\@ne
  \ifnum\eql@totalrows@>\@ne
    \ifnum\eql@row@=\@ne
      \eql@shape@pos@\z@
    \fi
    \ifnum\eql@row@=\eql@totalrows@
      \eql@shape@pos@\tw@
    \fi
  \fi
}
\def\eql@shape@layoutleft@steps{%
  \eql@shape@pos@\z@
  \eql@shape@amount@\z@
  \ifnum\eql@totalrows@>\@ne
    \ifnum\eql@row@=\@ne
      \eql@shape@amount@-\eql@indent@
    \fi
    \ifnum\eql@row@=\eql@totalrows@
      \eql@shape@amount@\eql@indent@
    \fi
  \fi
}
\let\eql@shape@eval\@undefined
\def\eql@shape@sel{%
  \expandafter\let\expandafter\eql@shape@eval
    \csname eql@shape%
    @\ifdefined\eql@layoutleft layoutleft\else layoutcenter\fi
    @\eql@shape@mode\endcsname
}
\def\eql@adjust@alignleft{%
  \global\eql@shape@pos@\z@
  \eql@srbgroup\eql@ifstar@tight
    {\eql@adjust@alignleft@[\eql@indent@]}%
    {\eql@ifnextgobble@tight{!}%
      {\eql@adjust@alignleft@[-\eql@indent@]}%
      {\eql@testopt@tight\eql@adjust@alignleft@\z@}%
    }%
}
\def\eql@adjust@alignleft@[#1]{%
  \eql@sregroup\global\eql@shape@amount@\glueexpr#1\relax}
\def\eql@adjust@aligncenter{%
  \global\eql@shape@pos@\@ne\global\eql@shape@amount@\z@}
\def\eql@adjust@alignright{%
  \global\eql@shape@pos@\tw@\global\eql@shape@amount@\z@}
\def\eql@adjust@try#1{%
  \setbox\eql@fieldbox@\hbox to\displaywidth{%
    \unhbox\eql@fieldbox@\unkern\kern#1}%
}
\def\eql@adjust@print#1#2{%
  \eql@restore@hfuzz
  \hbox to\displaywidth{%
    #1%
    \unhbox\eql@fieldbox@\unkern
    #2%
    \eql@tagging@mathaddlast
  }%
}
\def\eql@adjust@print@alignleft#1#2{%
  \ifnum\eql@row@=\@ne
    \global\eql@display@firstavail@#1%
  \fi
  \eql@adjust@print{\kern#1}{\kern#2}%
}
\def\eql@adjust@print@alignright#1#2{%
  \ifnum\eql@row@=\@ne
    \eql@display@firstavail@\displaywidth
    \advance\eql@display@firstavail@-\eql@fieldwidth@
    \global\advance\eql@display@firstavail@-#2%
  \fi
  \eql@adjust@print{\kern#1\hfil}{\unskip\kern#2}%
}
\def\eql@adjust@print@aligncenter#1#2{%
  \ifnum\eql@row@=\@ne
    \eql@display@firstavail@\displaywidth
    \advance\eql@display@firstavail@-\eql@fieldwidth@
    \advance\eql@display@firstavail@#1%
    \advance\eql@display@firstavail@-#2%
    \global\divide\eql@display@firstavail@\tw@
  \fi
  \eql@adjust@print{\kern#1\hfil}{\kern#2}%
}
\def\eql@adjust@init{%
  \eql@save@hfuzz
  \hfuzz\maxdimen
  \eql@shape@sel
}
\def\eql@adjust@sel@tag{%
  \eql@tagging@tagaddbox
  \ifcase\eql@shape@pos@
    \eql@tagging@alignleft
  \or
    \eql@tagging@aligncenter
  \or
    \eql@tagging@alignright
  \fi
  \csname eql@adjust%
    @\ifdefined\eql@layoutleft layoutleft\else layoutcenter\fi
    @\ifdefined\eql@tagsleft tagsleft\else tagsright\fi
    @\ifcase\eql@shape@pos@ alignleft\or aligncenter\or alignright\fi
    @tag\endcsname
}
\def\eql@adjust@sel@notag{%
  \eql@tagging@tagaddbox
  \ifcase\eql@shape@pos@
    \eql@tagging@alignleft
  \or
    \eql@tagging@aligncenter
  \or
    \eql@tagging@alignright
  \fi
  \csname eql@adjust%
    @\ifdefined\eql@layoutleft layoutleft\else layoutcenter\fi
    @\ifdefined\eql@tagsleft tagsleft\else tagsright\fi
    @\ifcase\eql@shape@pos@ alignleft\or aligncenter\or alignright\fi
    @notag\endcsname
}
\def\eql@adjust@calc{%
  \ifdefined\eql@layoutleft
    \eql@layoutleftmargin@\glueexpr\eql@layoutleftmargin@val\relax
  \else
    \eql@columns@inter@\z@
    \eql@adjust@tagmargin
    \ifdefined\eql@paddingmax
      \eql@marginleft@\z@
      \eql@marginright@\z@
    \else
      \dimen@\displaywidth
      \advance\dimen@-\eql@totalwidth@
      \advance\dimen@-\eql@tagmargin@
      \divide\dimen@\tw@
      \eql@marginleft@\dimen@
      \advance\eql@marginleft@-\glueexpr\eql@paddingleft@val\relax
      \ifdim\eql@marginleft@<\z@
        \eql@marginleft@\z@
      \fi
      \eql@marginright@\dimen@
      \advance\eql@marginright@-\glueexpr\eql@paddingright@val\relax
      \ifdim\eql@marginright@<\z@
        \eql@marginright@\z@
      \fi
    \fi
  \fi
}
\def\eql@adjust@layoutcenter@tagsright@aligncenter@notag{%
  \dimen@\displaywidth
  \advance\dimen@-\eql@fieldwidth@
  \ifdim\dimen@>\eql@tagmargin@
    \eql@adjust@print@aligncenter\z@\eql@tagmargin@
  \else
    \eql@adjust@print@alignleft\z@\z@
  \fi
}
\def\eql@adjust@layoutcenter@tagsright@aligncenter@tag{%
  \dimen@\displaywidth
  \ifdim\eql@tagwidth@<\eql@tagmargin@
    \advance\dimen@-\eql@tagmargin@
  \else
    \advance\dimen@-2\eql@tagwidth@
    \advance\dimen@\eql@tagmargin@
  \fi
  \ifdim\eql@fieldwidth@<\dimen@
    \eql@adjust@print@aligncenter\z@\eql@tagmargin@
    \eql@tagbox@print@tagsright
  \else
    \eql@adjust@try\eql@tagwidth@
    \ifnum\badness<\eql@maxbadness@
      \ifdim\eql@tagwidth@<\eql@tagmargin@
        \eql@adjust@print@alignleft\z@\eql@tagwidth@
      \else
        \eql@adjust@print@alignright\z@\eql@tagwidth@
      \fi
      \eql@tagbox@print@tagsright
    \else
      \eql@adjust@layoutcenter@tagsright@aligncenter@notag
      \eql@tagbox@print@tagsright@raise
    \fi
  \fi
}
\def\eql@adjust@layoutcenter@tagsleft@aligncenter@notag{%
  \dimen@\displaywidth
  \advance\dimen@-\eql@tagmargin@
  \ifdim\eql@fieldwidth@<\dimen@
    \eql@adjust@print@aligncenter\eql@tagmargin@\z@
  \else
    \eql@adjust@print@alignright\z@\z@
  \fi
}
\def\eql@adjust@layoutcenter@tagsleft@aligncenter@tag{%
  \dimen@\displaywidth
  \ifdim\eql@tagwidth@<\eql@tagmargin@
    \advance\dimen@-\eql@tagmargin@
  \else
    \advance\dimen@-2\eql@tagwidth@
    \advance\dimen@\eql@tagmargin@
  \fi
  \ifdim\eql@fieldwidth@<\dimen@
    \eql@tagbox@print@tagsleft
    \eql@adjust@print@aligncenter\eql@tagmargin@\z@
  \else
    \eql@adjust@try\eql@tagwidth@
    \ifnum\badness<\eql@maxbadness@
      \eql@tagbox@print@tagsleft
      \ifdim\eql@tagwidth@<\eql@tagmargin@
        \eql@adjust@print@alignright\eql@tagwidth@\z@
      \else
        \eql@adjust@print@alignleft\eql@tagwidth@\z@
      \fi
    \else
      \eql@tagbox@print@tagsleft@raise
      \eql@adjust@layoutcenter@tagsleft@aligncenter@notag
    \fi
  \fi
  \eql@display@firstavail@set\z@
}
\def\eql@adjust@layoutcenter@tagsright@alignleft@notag{%
  \dimen@\displaywidth
  \advance\dimen@-\eql@marginleft@
  \advance\dimen@-\eql@shape@amount@
  \ifdim\eql@fieldwidth@<\dimen@
    \dimen@\eql@marginleft@
    \advance\dimen@\eql@shape@amount@
    \eql@adjust@print@alignleft\dimen@\z@
  \else
    \eql@adjust@print@alignright\z@\z@
  \fi
}
\def\eql@adjust@layoutcenter@tagsright@alignleft@tag{%
  \dimen@\eql@marginleft@
  \advance\dimen@\eql@shape@amount@
  \advance\dimen@\eql@tagwidth@
  \eql@adjust@try\dimen@
  \ifnum\badness<\eql@marginbadness@
    \dimen@\eql@marginleft@
    \advance\dimen@\eql@shape@amount@
    \eql@adjust@print@alignleft\dimen@\eql@tagwidth@
    \eql@tagbox@print@tagsright
  \else
    \ifdim\eql@marginleft@>-\eql@shape@amount@
      \eql@adjust@try\eql@tagwidth@
    \fi
    \ifnum\badness<\eql@maxbadness@
      \eql@adjust@print@alignright\z@\eql@tagwidth@
      \eql@tagbox@print@tagsright
    \else
      \eql@adjust@layoutcenter@tagsright@alignleft@notag
      \eql@tagbox@print@tagsright@raise
    \fi
  \fi
}
\def\eql@adjust@layoutcenter@tagsleft@alignright@notag{%
  \dimen@\displaywidth
  \advance\dimen@-\eql@tagmargin@
  \advance\dimen@-\eql@marginright@
  \ifdim\eql@fieldwidth@<\dimen@
    \eql@adjust@print@alignright\z@\eql@marginright@
  \else
    \eql@adjust@print@alignleft\z@\z@
  \fi
}
\def\eql@adjust@layoutcenter@tagsleft@alignright@tag{%
  \dimen@\eql@marginright@
  \advance\dimen@\eql@tagwidth@
  \eql@adjust@try\dimen@
  \ifnum\badness<\eql@marginbadness@
    \eql@tagbox@print@tagsleft
    \eql@adjust@print@alignright\eql@tagwidth@\eql@marginright@
  \else
    \ifdim\eql@marginright@>\z@
      \eql@adjust@try\eql@tagwidth@
    \fi
    \ifnum\badness<\eql@maxbadness@
      \eql@tagbox@print@tagsleft
      \eql@adjust@print@alignleft\eql@tagwidth@\z@
    \else
      \eql@tagbox@print@tagsleft@raise
      \eql@adjust@layoutcenter@tagsleft@alignright@notag
    \fi
  \fi
  \eql@display@firstavail@set\z@
}
\def\eql@adjust@layoutcenter@tagsright@alignright@notag{%
  \dimen@\displaywidth
  \advance\dimen@-\eql@tagmargin@
  \advance\dimen@-\eql@marginright@
  \ifdim\eql@fieldwidth@<\dimen@
    \dimen@\eql@tagmargin@
    \advance\dimen@\eql@marginright@
    \eql@adjust@print@alignright\z@\dimen@
  \else
    \eql@adjust@print@alignleft\z@\z@
  \fi
}
\def\eql@adjust@layoutcenter@tagsright@alignright@tag{%
  \dimen@\eql@tagmargin@
  \advance\dimen@\eql@marginright@
  \ifdim\eql@tagwidth@<\dimen@
    \eql@adjust@try\dimen@%
    \ifnum\badness<\eql@marginbadness@
      \eql@adjust@print@alignright\z@\dimen@
      \eql@tagbox@print@tagsright
    \else
      \eql@adjust@try\eql@tagwidth@
      \ifnum\badness<\eql@maxbadness@
        \eql@adjust@print@alignleft\z@\eql@tagwidth@
        \eql@tagbox@print@tagsright
      \else
        \eql@adjust@print@alignleft\z@\z@
        \eql@tagbox@print@tagsleft@raise
      \fi
    \fi
  \else
    \eql@adjust@try\eql@tagwidth@
    \ifnum\badness<\eql@maxbadness@
      \eql@adjust@print@alignright\z@\eql@tagwidth@
      \eql@tagbox@print@tagsright
    \else
      \eql@adjust@layoutcenter@tagsright@alignright@notag
      \eql@tagbox@print@tagsright@raise
    \fi
  \fi
}
\def\eql@adjust@layoutcenter@tagsleft@alignleft@notag{%
  \dimen@\displaywidth
  \advance\dimen@-\eql@tagmargin@
  \advance\dimen@-\eql@marginleft@
  \advance\dimen@-\eql@shape@amount@
  \ifdim\eql@fieldwidth@<\dimen@
    \dimen@\eql@tagmargin@
    \advance\dimen@\eql@marginleft@
    \advance\dimen@\eql@shape@amount@
    \eql@adjust@print@alignleft\dimen@\z@
  \else
    \eql@adjust@print@alignright\z@\z@
  \fi
}
\def\eql@adjust@layoutcenter@tagsleft@alignleft@tag{%
  \dimen@\eql@tagmargin@
  \advance\dimen@\eql@marginleft@
  \advance\dimen@\eql@shape@amount@
  \ifdim\eql@tagwidth@<\dimen@
    \eql@adjust@try\dimen@%
    \ifnum\badness<\eql@marginbadness@
      \eql@tagbox@print@tagsleft
      \eql@adjust@print@alignleft\dimen@\z@
    \else
      \eql@adjust@try\eql@tagwidth@
      \ifnum\badness<\eql@maxbadness@
        \eql@tagbox@print@tagsleft
        \eql@adjust@print@alignright\eql@tagwidth@\z@
      \else
        \eql@tagbox@print@tagsleft@raise
        \eql@adjust@print@alignright\z@\z@
      \fi
    \fi
  \else
    \eql@adjust@try\eql@tagwidth@
    \ifnum\badness<\eql@maxbadness@
      \eql@tagbox@print@tagsleft
      \eql@adjust@print@alignleft\eql@tagwidth@\z@
    \else
      \eql@tagbox@print@tagsleft@raise
      \eql@adjust@layoutcenter@tagsleft@alignleft@notag
    \fi
  \fi
  \eql@display@firstavail@set\z@
}
\def\eql@adjust@tagmargin{%
  \ifdefined\eql@tagmargin@val
    \eql@tagmargin@\glueexpr\eql@tagmargin@val\relax
  \else
    \eql@tagmargin@\eql@tagwidth@max@
    \ifdim\eql@tagmargin@>\z@
      \advance\eql@tagmargin@-\eql@tagsepmin@
    \fi
  \fi
  \dimen@\eql@tagrows@\p@
  \ifnum\eql@totalrows@=\@ne
    \ifnum\eql@tagrows@=\@ne
      \advance\dimen@1sp\relax
    \fi
  \fi
  \ifdim\dimen@>\eql@totalrows@\eql@tagmargin@ratio@\else
    \eql@tagmargin@\z@
  \fi
  \@tempdima\displaywidth
  \advance\@tempdima-\eql@totalwidth@
  \advance\@tempdima-\eql@columns@inter@\eql@colsepmin@
  \@tempdimb\@tempdima
  \advance\@tempdimb-\tw@\eql@tagmargin@
  \ifdim\@tempdimb>\z@
    \ifdim\eql@tagmargin@threshold\@tempdima<\@tempdimb
      \eql@tagmargin@\z@
    \fi
  \fi
}
\def\eql@adjust@layoutleft@alignleft{%
  \eql@marginleft@\eql@layoutleftmargin@
  \advance\eql@marginleft@\eql@shape@amount@
  \ifdim\eql@marginleft@<\eql@layoutleftmarginmin@
    \eql@marginleft@\eql@layoutleftmarginmin@
  \fi
  \ifdim\eql@marginleft@>\eql@layoutleftmarginmax@
    \eql@marginleft@\eql@layoutleftmarginmax@
  \fi
}
\def\eql@adjust@layoutleft@alignleft@notag{%
  \ifdim\eql@layoutleftmarginmin@<\eql@marginleft@
    \eql@adjust@try\eql@marginleft@
    \ifnum\badness<\eql@marginbadness@
      \eql@adjust@print@alignleft\eql@marginleft@\z@
    \else
      \eql@adjust@print@alignleft\eql@layoutleftmarginmin@\z@
    \fi
  \else
    \eql@adjust@print@alignleft\eql@marginleft@\z@
  \fi
}
\def\eql@adjust@layoutleft@tagsright@alignleft@notag{%
  \eql@adjust@layoutleft@alignleft
  \eql@adjust@layoutleft@alignleft@notag
}
\let\eql@adjust@layoutleft@tagsleft@alignleft@notag
  \eql@adjust@layoutleft@tagsright@alignleft@notag
\def\eql@adjust@layoutleft@tagsright@alignleft@tag{%
  \eql@adjust@layoutleft@alignleft
  \dimen@\eql@marginleft@
  \advance\dimen@\eql@tagwidth@
  \eql@adjust@try\dimen@
  \ifnum\badness<\eql@marginbadness@
    \eql@adjust@print@alignleft\eql@marginleft@\eql@tagwidth@
    \eql@tagbox@print@tagsright
  \else
    \ifdim\eql@layoutleftmarginmin@<\eql@marginleft@
      \dimen@\eql@layoutleftmarginmin@
      \advance\dimen@\eql@tagwidth@
      \eql@adjust@try\dimen@
    \fi
    \ifnum\badness<\eql@maxbadness@
      \eql@adjust@print@alignleft\eql@layoutleftmarginmin@\eql@tagwidth@
      \eql@tagbox@print@tagsright
    \else
      \eql@adjust@layoutleft@alignleft@notag
      \eql@tagbox@print@tagsright@raise
    \fi
  \fi
}
\def\eql@adjust@layoutleft@tagsleft@alignleft@tag{%
  \eql@adjust@layoutleft@alignleft
  \ifdim\eql@tagwidth@<\eql@layoutleftmarginmin@
    \eql@tagbox@print@tagsleft
    \eql@adjust@layoutleft@notag
  \else
    \ifdim\eql@tagwidth@<\eql@marginleft@
      \eql@adjust@try\eql@marginleft@
      \ifnum\badness<\eql@marginbadness@
        \eql@tagbox@print@tagsleft
        \eql@adjust@print@alignleft\eql@marginleft@\z@
      \else
        \eql@adjust@try\eql@tagwidth@
        \ifnum\badness<\eql@maxbadness@
          \eql@tagbox@print@tagsleft
          \eql@adjust@print@alignleft\eql@tagwidth@\z@
        \else
          \eql@tagbox@print@tagsleft@raise
          \eql@adjust@print@alignleft\eql@layoutleftmarginmin@\z@
        \fi
      \fi
    \else
      \ifdim\eql@tagwidth@>\eql@layoutleftmarginmax@
        \eql@tagbox@print@tagsleft@raise
        \eql@adjust@layoutleft@alignleft@notag
      \else
        \eql@adjust@try\eql@tagwidth@
        \ifnum\badness<\eql@maxbadness@
          \eql@tagbox@print@tagsleft
          \eql@adjust@print@alignleft\eql@tagwidth@\z@
        \else
          \eql@tagbox@print@tagsleft@raise
          \eql@adjust@layoutleft@alignleft@notag
        \fi
      \fi
    \fi
  \fi
  \eql@display@firstavail@set\z@
}
\def\eql@adjust@layoutleft@alignright@notag{%
  \eql@marginleft@\eql@layoutleftmargin@
  \ifdim\eql@layoutleftmarginmin@<\eql@marginleft@
    \eql@adjust@try\eql@marginleft@
    \ifnum\badness<\eql@marginbadness@
      \eql@adjust@print@alignright\eql@marginleft@\z@
    \else
      \eql@adjust@print@alignright\eql@layoutleftmarginmin@\z@
    \fi
  \else
    \eql@adjust@print@alignright\eql@marginleft@\z@
  \fi
}
\let\eql@adjust@layoutleft@tagsright@alignright@notag
  \eql@adjust@layoutleft@alignright@notag
\let\eql@adjust@layoutleft@tagsleft@alignright@notag
  \eql@adjust@layoutleft@alignright@notag
\def\eql@adjust@layoutleft@tagsright@alignright@tag{%
  \dimen@\eql@marginleft@
  \advance\dimen@\eql@tagwidth@
  \eql@adjust@try\dimen@
  \ifnum\badness<\eql@marginbadness@
    \eql@adjust@print@alignright\eql@marginleft@\eql@tagwidth@
    \eql@tagbox@print@tagsright
  \else
    \ifdim\eql@layoutleftmarginmin@<\eql@marginleft@
      \dimen@\eql@layoutleftmarginmin@
      \advance\dimen@\eql@tagwidth@
      \eql@adjust@try\dimen@
    \fi
    \ifnum\badness<\eql@maxbadness@
      \eql@adjust@print@alignright\eql@layoutleftmarginmin@\eql@tagwidth@
      \eql@tagbox@print@tagsright
    \else
      \eql@adjust@layoutleft@alignright@notag
      \eql@tagbox@print@tagsright@raise
    \fi
  \fi
}
\def\eql@adjust@layoutleft@tagsleft@alignright@tag{%
  \ifdim\eql@tagwidth@<\eql@layoutleftmarginmin@
    \eql@tagbox@print@tagsleft
    \eql@adjust@layoutleft@alignright@notag
  \else
    \ifdim\eql@tagwidth@<\eql@marginleft@
      \eql@adjust@try\eql@marginleft@
      \ifnum\badness<\eql@marginbadness@
        \eql@tagbox@print@tagsleft
        \eql@adjust@print@alignright\eql@marginleft@\z@
      \else
        \eql@adjust@try\eql@tagwidth@
        \ifnum\badness<\eql@maxbadness@
          \eql@tagbox@print@tagsleft
          \eql@adjust@print@alignright\eql@tagwidth@\z@
        \else
          \eql@tagbox@print@tagsleft@raise
          \eql@adjust@print@alignright\eql@layoutleftmarginmin@\z@
        \fi
      \fi
    \else
      \ifdim\eql@tagwidth@>\eql@layoutleftmarginmax@
        \eql@tagbox@print@tagsleft@raise
        \eql@adjust@layoutleft@alignright@notag
      \else
        \eql@adjust@try\eql@tagwidth@
        \ifnum\badness<\eql@maxbadness@
          \eql@tagbox@print@tagsleft
          \eql@adjust@print@alignright\eql@tagwidth@\z@
        \else
          \eql@tagbox@print@tagsleft@raise
          \eql@adjust@layoutleft@alignright@notag
        \fi
      \fi
    \fi
  \fi
  \eql@display@firstavail@set\z@
}
\def\eql@adjust@layoutleft@aligncenter{%
  \eql@error{shove center not implemented for left alignment}%
}
\let\eql@adjust@layoutleft@tagsright@aligncenter@notag
  \eql@adjust@layoutleft@aligncenter
\let\eql@adjust@layoutleft@tagsright@aligncenter@tag
  \eql@adjust@layoutleft@aligncenter
\let\eql@adjust@layoutleft@tagsleft@aligncenter@notag
  \eql@adjust@layoutleft@aligncenter
\let\eql@adjust@layoutleft@tagsleft@aligncenter@tag
  \eql@adjust@layoutleft@aligncenter
\let\eql@fieldlength@tab\@empty
\def\eql@fieldlength@save#1{%
  \begingroup
    \let\or\relax
    \global\edef\eql@fieldlength@tab{%
      \eql@fieldlength@tab
      \ifnum#1=\@ne
        \or
      \else
        ,%
      \fi
      \the\wd\eql@fieldbox@
    }%
  \endgroup
}
\def\eql@fieldlength@get#1{%
  \ifcase\expandafter#1\eql@fieldlength@tab\fi
}
\let\eql@tagwidth@tab\@empty
\def\eql@tagwidth@get#1{%
  \ifcase\expandafter#1\eql@tagwidth@tab\fi
}
\def\eql@tagwidth@save{%
  \begingroup
    \let\or\relax
    \global\edef\eql@tagwidth@tab{\eql@tagwidth@tab\or\the\eql@tagwidth@}%
  \endgroup
}
\def\eql@tagwidth@savezero{%
  \begingroup
    \let\or\relax
    \global\edef\eql@tagwidth@tab{\the\eql@tagwidth@\eql@tagwidth@tab}%
  \endgroup
}
\let\eql@colwidth@tab\@empty
\def\eql@columns@colwidth@get#1{%
  \ifcase\expandafter#1\eql@colwidth@tab\else\z@\fi
}
\def\eql@columns@colwidth@save{%
  \begingroup
    \let\or\relax
    \global\edef\eql@colwidth@tab{\or\the\wd\thr@@\eql@colwidth@tab}%
  \endgroup
}
\def\eql@measure@init#1{%
  \measuring@true
  \eql@row@\z@
  \let\displaybreak\eql@displaybreak@measure
  \tabskip\z@skip
  \everycr{%
    \noalign{%
      \global\advance\eql@row@\@ne
      #1%
    }%
  }%
}
\let\eql@measure@restorecounters\@empty
\def\eql@measure@savecounters{%
  \begingroup
    \def\@elt##1{%
      \global\csname c@##1\endcsname\the\csname c@##1\endcsname}%
    \global\edef\@gtempa{%
      \cl@@ckpt
      \let\noexpand\eql@measure@restorecounters\noexpand\@empty
    }%
  \endgroup
  \let\eql@measure@restorecounters\@gtempa
}
\def\eql@print@init#1{%
  \eql@row@\z@
  \eql@halign@init{%
    \global\eql@displaybreak@pen@\@MM
    \global\advance\eql@row@\@ne
    #1%
  }%
}
\def\eql@print@overfull{%
  \dimen@\eql@line@width@
  \advance\dimen@-\hfuzz
  \ifdim\dimen@>\displaywidth
    \setbox\z@\hbox to\displaywidth{\hbox to\eql@line@width@{\hfil}}%
    \wd\z@\z@
    \ht\z@\eql@line@height@
    \dp\z@\eql@line@depth@
    \box\z@
  \fi
}
\def\eql@tagbox@print@multi{%
  \advance\eql@tagwidth@-\eql@tagfuzz@
  \ifdefined\eql@tagsleft
    \eql@display@firstavail@set\z@
    \ifdim\eql@tagwidth@>\eql@line@avail@
      \eql@tagbox@print@tagsleft@raise
    \else
      \eql@tagbox@print@tagsleft
    \fi
    \kern\displaywidth
  \else
    \kern\displaywidth
    \advance\eql@tagwidth@\eql@line@width@
    \ifdim\eql@tagwidth@>\displaywidth
      \eql@tagbox@print@tagsright@raise
    \else
      \eql@tagbox@print@tagsright
    \fi
  \fi
}
\protected\def\eql@math@cr{%
  \eql@ampprotecttwo\eql@teststaropt@tight
    {\global\eql@displaybreak@pen@\@M\eql@math@cr@}\eql@math@cr@\z@}
\def\eql@math@cr@[#1]{%
  \eql@math@cr@@@
  \cr
  \noalign{%
    \ifnum\eql@displaybreak@pen@=\@MM
      \penalty\interdisplaylinepenalty
    \else
      \penalty\eql@displaybreak@pen@
    \fi
    \advance\eql@vspaceskip@\glueexpr#1\relax%
    \vskip\eql@vspaceskip@
    \global\eql@vspaceskip@\z@skip
  }%
}
\def\eql@let@cr#1{%
  \let\\\eql@math@cr
  \let\eql@math@cr@@@#1%
}
\def\eql@intertext@default{\eql@error{Invalid use of \string\intertext}}
\eql@amsmath@let\intertext\eql@intertext@default
\def\eql@intertext@process{%
  \eql@math@cr@@@
  \cr
  \ifmeasuring@
    \expandafter\@gobble
  \else
    \expandafter\eql@intertext@print
  \fi
}
\def\eql@intertext@print#1{%
  \noalign{%
    \eql@halign@after
    \let\eql@skip@force@below\z@
    \let\eql@skip@force@above\z@
    \eql@setkeys{intertext}\eql@intertext@opt
    \openup-\eql@spread@
    \penalty\postdisplaypenalty
    \ifcase\eql@skip@force@below\relax
      \advance\eql@vspaceskip@\glueexpr\eql@skip@long@below\relax
    \or
      \advance\eql@vspaceskip@\glueexpr\eql@skip@short@below\relax
    \or
      \advance\eql@vspaceskip@\glueexpr\eql@skip@cont@below\relax
    \or
      \advance\eql@vspaceskip@\glueexpr\eql@skip@par@below\relax
    \or
      \advance\eql@vspaceskip@\glueexpr\eql@skip@top@below\relax
    \or
      \advance\eql@vspaceskip@\z@skip
    \or
      \advance\eql@vspaceskip@\glueexpr\eql@skip@med@below\relax
    \or
      \advance\eql@vspaceskip@\glueexpr\eql@skip@custom@below\relax
    \fi
    \vskip\eql@vspaceskip@
    \global\eql@vspaceskip@\z@skip
    \vbox{%
      \@parboxrestore
      \ifdim
        \ifdim\@totalleftmargin=\z@\linewidth\else-\maxdimen\fi=\columnwidth
      \else
        \parshape\@ne
        \@totalleftmargin\linewidth
      \fi
      \noindent
      \ignorespaces
      #1%
      \par
    }%
    \penalty\predisplaypenalty
    \ifcase\eql@skip@force@above\relax
      \vskip\glueexpr\eql@skip@long@above\relax
    \or
      \vskip\glueexpr\eql@skip@short@above\relax
    \or
      \vskip\glueexpr\eql@skip@cont@above\relax
    \or
      \vskip\glueexpr\eql@skip@par@above\relax
    \or
      \vskip\glueexpr\eql@skip@top@above\relax
    \or
      \vskip\z@skip
    \or
      \vskip\glueexpr\eql@skip@med@above\relax
    \or
      \vskip\glueexpr\eql@skip@custom@above\relax
    \fi
    \eql@halign@prevdepth@\z@
    \eql@halign@before
  }
}
\newenvironment{eql@intertext}{%
  \eql@testopt@tight\eql@intertext@{}%
}{%
  \aftergroup\eql@intertext@after
  \ignorespacesafterend
}
\def\eql@intertext@env{intertext}
\def\eql@intertext@[#1]{%
  \global\def\eql@intertext@opt{#1}%
  \ifx\@currenvir\eql@intertext@env
    \expandafter\eql@scan@env\expandafter\eql@intertext@inject
  \else
    \expandafter\eql@intertext@process
  \fi
}
\def\eql@intertext@inject{%
  \global\edef\eql@intertext@after{%
    \noexpand\eql@intertext@process{%
      \ifx\eql@scan@body\eql@scan@body@dump
        \eql@scan@body@dump
      \else
        \noexpand\scantokens{\eql@scan@body@dump}%
      \fi
    }%
  }%
}
\protected\def\eql@box@cr{%
  \eql@ampprotect\eql@testopt@tight\eql@box@cr@\z@
}
\def\eql@box@cr@[#1]{%
  \eql@punct@apply@line
  \eql@hook@lineout
  \eql@box@lastfield
  \cr
  \noalign{%
    \vskip\glueexpr#1\relax
  }%
}
\def\eql@box@lastfield@lines{&\omit\kern-2\eql@colsep@}
\def\eql@box@open@stacked{%
  \let\shoveleft\eql@adjust@alignleft
  \let\shovecenter\eql@adjust@aligncenter
  \let\shoveright\eql@adjust@alignright
  \let\eql@box@lastfield\eql@box@lastfield@lines
  \eql@halign@init{%
    \global\advance\eql@row@\@ne
  }%
  \tabskip\z@skip
  \halign\bgroup
    &%
      \eql@shape@pos@\m@ne
      \setbox\eql@fieldbox@\hbox{%
        \eql@strut@field
        \@lign
        $\m@th\displaystyle
          \eql@hook@colin
          ##%
          \eql@punct@apply@col
          \eql@hook@colout
          \eql@tagging@mathsave
        $%
        \eql@tagging@mathaddlast
      }%
      \ifnum\eql@shape@pos@=\m@ne
        \eql@shape@eval
      \fi
      \ifcase\eql@shape@pos@
        \kern\eql@shape@amount@
        \box\eql@fieldbox@
        \skip@\@flushglue
        \advance\skip@\eql@paddingleft@\relax
        \advance\skip@\eql@paddingright@\relax
        \advance\skip@-\eql@shape@amount@\relax
        \hskip\skip@
        \eql@tagging@alignleft
      \or
        \skip@\@flushglue
        \advance\skip@\eql@paddingleft@\relax
        \hskip\skip@
        \box\eql@fieldbox@
        \skip@\@flushglue
        \advance\skip@\eql@paddingright@\relax
        \hskip\skip@
        \eql@tagging@aligncenter
      \or
        \skip@\@flushglue
        \advance\skip@\eql@paddingleft@\relax
        \advance\skip@\eql@paddingright@\relax
        \hskip\skip@
        \box\eql@fieldbox@
        \eql@tagging@alignright
      \fi
      \tabskip\eql@colsep@\relax
    \crcr
    \noalign{%
      \eql@hook@blockbefore
    }%
    \eql@hook@blockin
}
\def\eql@mode@stacked{\let\eql@box@open\eql@box@open@stacked}
\def\eql@box@lastfield@odd{%
  &\omit
  \kern-\wd\eql@fieldbox@
  \box\eql@fieldbox@
  \hfil
  &\omit\kern-\eql@colsep@
}%
\def\eql@box@lastfield@even{&\omit\kern-\eql@colsep@}
\def\eql@box@open@aligned{%
  \let\eql@box@lastfield\@empty
  \eql@halign@init{%
  }%
  \tabskip\z@skip
  \halign\bgroup
    &%
      \let\eql@box@lastfield\eql@box@lastfield@odd
      \global\setbox\eql@fieldbox@\hbox{%
        \eql@strut@field
        \@lign
        $\m@th\displaystyle
          \eql@hook@colin
          ##%
          \eql@class@innerleft
          \eql@hook@innerleft
          \eql@tagging@mathsave
        $%
        \eql@tagging@mathaddlast
      }%
      \hfil
      \kern\wd\eql@fieldbox@
      \tabskip\z@skip
    &%
      \eql@fieldwidth@\wd\eql@fieldbox@
      \kern-\eql@fieldwidth@
      \box\eql@fieldbox@
      \let\eql@box@lastfield\eql@box@lastfield@even
      \llap{\unhbox\eql@fieldbox@}%
      \hbox{%
        \eql@strut@field
        \@lign
        $\m@th\displaystyle
          \eql@hook@innerright
          \eql@class@innerright@sel
          ##%
          \eql@punct@apply@col
          \eql@hook@colout
          \eql@tagging@mathsave
        $%
        \eql@tagging@mathaddlast
      }%
      \hfil
      \tabskip\eql@colsep@\relax
    \crcr
    \noalign{%
      \eql@hook@blockbefore
    }%
    \eql@hook@blockin
}
\def\eql@mode@aligned{\let\eql@box@open\eql@box@open@aligned}
\let\eql@box@box\vcenter
\let\eql@box@open\@undefined
\def\eql@box@close{%
    \ifvmode\else
      \global\eql@totalrows@\eql@row@
      \eql@punct@apply@block
      \eql@box@cr@[\z@skip]%
    \fi
    \crcr
    \noalign{%
      \eql@hook@blockafter
    }%
    \eql@tagging@tablesaveinner
  \egroup
}
\def\eql@box@start{%
  \relax
  \ifmmode
    \let\eql@box@endmath\@empty
  \else
    $\let\eql@box@endmath=$%
  \fi
  \eql@nextopt@process{equationsbox}%
  \let\eql@punct@block\eql@punct@main
  \let\eql@punct@main\relax
  \eql@colsep@\glueexpr\eql@box@colsep\relax
  \eql@paddingleft@\glueexpr\eql@paddingleft@val\relax
  \eql@paddingright@\glueexpr\eql@paddingright@val\relax
  \eql@indent@\glueexpr\eql@indent@val\relax
  \eql@stack@save@boxed
  \let\eql@layoutleft\eql@false
  \eql@row@\z@
  \eql@totalrows@\@M
  \eql@shape@sel
  \hskip\glueexpr\eql@box@marginleft\relax
  \eql@box@box\bgroup
    \eql@display@leave
    \let\\\eql@box@cr
    \eql@box@open
}
\newcommand{\eql@box@end}{%
    \eql@box@close
  \egroup
  \eql@tagging@tableaddinner
  \hskip\glueexpr\eql@box@marginright\relax
  \eql@stack@restore
  \eql@box@endmath
}
\newenvironment{equationsbox}{%
  \eql@ampprotect\eql@box@testall\eql@box@start
}{%
  \eql@box@end
}
\def\eql@box@testall{\eql@box@testtilde}
\def\eql@box@testtilde#1{%
  \eql@ifnextgobble@tight~%
    {\eqnaddopt{lines}\eql@box@testopt{#1}}%
    {\eql@box@testopt{#1}}}
\def\eql@box@testopt#1{%
  \eql@ifnextchar@tight[%]
    {\eql@box@addopt{#1}}%
    {#1}}
\def\eql@box@addopt#1[#2]{\eqnaddopt{#2}#1}
\def\eql@single@start@native{%
  \eql@hook@eqin
}%
\def\eql@single@end@native{%
  \if@eqnsw
    \ifdefined\eql@tagsleft
      \leqno
    \else
      \eqno
    \fi
    \eql@compose@print
  \fi
  \ifnum\eql@displaybreak@pen@=\@MM\else
    \postdisplaypenalty\eql@displaybreak@pen@
  \fi
}%
\def\eql@single@start@print{%
  \eql@totalrows@\@ne
  \eql@row@\z@
  \eql@display@init
  \let\shoveleft\eql@adjust@alignleft
  \let\shovecenter\eql@adjust@aligncenter
  \let\shoveright\eql@adjust@alignright
  \eql@adjust@init
  \eql@shape@eval
  \eql@halign@init{}%
  \eql@row@\@ne
  \setbox\eql@fieldbox@\hbox\bgroup
    \eql@restore@hfuzz
    \eql@strut@field
    $\m@th\displaystyle%$
      \eql@hook@eqin
}
\def\eql@single@end@print{%
    \eql@tagging@mathsave
    $%$
    \hfil
    \kern\z@
  \egroup
  \eql@fieldwidth@\wd\eql@fieldbox@
  \eql@line@height@\ht\eql@fieldbox@
  \eql@line@depth@\dp\eql@fieldbox@
  \eql@totalwidth@\eql@fieldwidth@
  \eql@totalrows@\@ne
  \if@eqnsw
    \eql@tagbox@make\eql@compose@print
    \eql@tagrows@\@ne
  \else
    \eql@tagwidth@\z@
    \eql@tagrows@\z@
  \fi
  \eql@tagwidth@max@\eql@tagwidth@
  \eql@adjust@calc
  \halign{##\cr
    \noalign{\eql@halign@before}%
    \if@eqnsw
      \eql@adjust@sel@tag
    \else
      \eql@adjust@sel@notag
    \fi
    \cr
    \noalign{\eql@halign@after}%
    \eql@tagging@tablesavelines
  }%
  \eql@row@\tw@
  \eql@display@close
}
\def\eql@lines@measure@line@begin{%
  \eql@numbering@measure@line@begin
  \eql@hook@linein
}
\def\eql@lines@measure@line@end{%
  \eql@punct@apply@line
  \eql@hook@lineout
}
\def\eql@lines@measure@field{%
  \kern\wd\eql@fieldbox@
}
\def\eql@lines@measure@tag{%
  \ifnum\eql@numbering@target@<\z@
    \if@eqnsw
      \eql@tagbox@make\eql@compose@measure
      \ifdim\eql@tagwidth@>\eql@tagwidth@max@
        \global\eql@tagwidth@max@\eql@tagwidth@
      \fi
      \global\advance\eql@tagrows@\@ne
    \else
      \eql@tagwidth@\z@
    \fi
  \fi
}
\def\eql@lines@measure{%
  \eql@tagwidth@max@\z@
  \eql@tagrows@\z@
  \eql@measure@savecounters
  \setbox\z@\vbox{%
    \eql@numbering@measure@init
    \eql@measure@init\eql@lines@measure@line@begin
    \eql@let@cr\eql@lines@measure@line@end
    \halign{%
      \setbox\eql@fieldbox@\hbox{%
        \@lign
        $\m@th\displaystyle
          \eql@hook@colin
          ##%
          \eql@punct@apply@col
          \eql@hook@colout
        $%
      }%
      \eql@lines@measure@field
      \eql@lines@measure@tag
      \crcr
      \noalign{%
        \eql@hook@blockbefore
      }%
      \eql@hook@blockin
      \eql@scan@body
      \ifvmode\else
        \eql@punct@apply@block
        \eql@hook@blockout
        \eql@lines@measure@line@end
        \cr
      \fi
      \omit
      \cr
      \noalign{%
        \eql@hook@blockafter
      }%
    }%
    \global\advance\eql@row@-\tw@
    \eql@numbering@measure@eval
    \ifnum\eql@numbering@target@>\z@
      \eql@tagbox@make\eql@compose@measure
      \global\eql@tagwidth@max@\eql@tagwidth@
      \global\eql@tagrows@\@ne
    \fi
  }%
  \eql@totalrows@\eql@row@
  \ifdefined\eql@numbering@subeq@use
    \eql@numbering@subeq@test
  \fi
  \eql@measure@restorecounters
  \setbox\z@\vbox{%
    \unvbox\z@
    \unpenalty
    \global\setbox\@ne\lastbox
  }%
  \eql@totalwidth@\wd\@ne
}
\def\eql@lines@print@line@begin{%
  \eql@numbering@print@line@begin
  \eql@hook@linein
}
\def\eql@lines@print@line@end{%
  \eql@punct@apply@line
  \eql@hook@lineout
}
\def\eql@lines@print@line@adjust{%
  \eql@numbering@print@line@eval
  \eql@fieldwidth@\wd\eql@fieldbox@
  \eql@line@height@\ht\eql@fieldbox@
  \eql@line@depth@\dp\eql@fieldbox@
  \if@eqnsw
    \eql@tagbox@make\eql@compose@print
    \eql@adjust@sel@tag
  \else
    \eql@adjust@sel@notag
  \fi
}
\def\eql@lines@print{%
  \eql@display@init
  \eql@adjust@init
  \eql@adjust@calc
  \eql@numbering@print@init
  \eql@print@init\eql@lines@print@line@begin
  \eql@let@cr\eql@lines@print@line@end
  \tabskip\z@skip
  \halign{%
      \eql@shape@eval
      \setbox\eql@fieldbox@\hbox{%
        \eql@restore@hfuzz
        \eql@strut@field
        \@lign
        $\m@th\displaystyle
          \eql@hook@colin
          ##%
          \eql@punct@apply@col
          \eql@hook@colout
          \eql@tagging@mathsave
        $%
        \hfil
        \kern\z@
      }%
      \eql@lines@print@line@adjust
      \crcr
    \noalign{%
      \eql@halign@before
      \eql@numbering@print@block@begin
      \eql@hook@blockbefore
    }%
    \eql@hook@blockin
    \eql@scan@body
    \ifvmode\else
      \eql@punct@apply@block
      \eql@hook@blockout
      \eql@lines@print@line@end
      \cr
    \fi
    \noalign{%
      \eql@hook@blockafter
      \eql@halign@after
    }%
    \eql@tagging@tablesavelines
  }%
  \eql@display@close
}
\def\eql@columns@add@amp#1{\if m#1&\omit\expandafter\eql@columns@add@amp\fi}
\def\eql@columns@completerow{%
  \count@\eql@totalcolumns@
  \advance\count@-\eql@column@
  \advance\count@\@ne
  \edef\eql@tmp{%
    \expandafter\eql@columns@add@amp\romannumeral\number\count@ 000q}%
  \eql@tmp
}
\def\eql@columns@measure@line@begin{%
  \global\eql@column@\z@
  \eql@numbering@measure@line@begin
  \eql@hook@linein
}
\def\eql@columns@measure@field{%
  \eql@fieldlength@save\eql@column@
  \kern\wd\eql@fieldbox@
}
\def\eql@columns@measure@line@end{%
  \eql@punct@apply@line
  \eql@hook@lineout
  &\omit
  \ifnum\eql@column@>\eql@totalcolumns@
    \global\eql@totalcolumns@\eql@column@
  \fi
  \eql@columns@measure@tag
}
\def\eql@columns@measure@tag{%
  \ifnum\eql@numbering@target@<\z@
    \if@eqnsw
      \eql@tagbox@make\eql@compose@measure
      \ifdim\eql@tagwidth@>\eql@tagwidth@max@
        \global\eql@tagwidth@max@\eql@tagwidth@
      \fi
      \global\advance\eql@tagrows@\@ne
    \else
      \eql@tagwidth@\z@
    \fi
    \eql@tagwidth@save
  \fi
}
\def\eql@columns@measure{%
  \eql@totalcolumns@\z@
  \eql@tagwidth@max@\z@
  \let\eql@tagwidth@tab\@empty
  \let\eql@fieldlength@tab\@empty
  \eql@tagrows@\z@
  \eql@measure@savecounters
  \setbox\z@\vbox{%
    \eql@numbering@measure@init
    \eql@measure@init\eql@columns@measure@line@begin
    \eql@let@cr\eql@columns@measure@line@end
    \tabskip\z@skip
    \halign{%
      &%
        \global\advance\eql@column@\@ne
        \hfil
        \global\setbox\eql@fieldbox@\hbox{%
          \@lign
          $\m@th\displaystyle
            \eql@hook@colin
            ##%
            \eql@class@innerleft
            \eql@hook@innerleft
          $%
        }%
        \global\eql@fieldwidth@\wd\eql@fieldbox@
        \eql@columns@measure@field
      &%
        \global\advance\eql@column@\@ne
        \setbox\eql@fieldbox@\hbox{%
          \@lign
          $\m@th\displaystyle
            \eql@hook@innerright
            \eql@class@innerright@sel
            ##%
            \eql@punct@apply@col
            \eql@hook@colout
          $%
        }%
        \eql@columns@measure@field
        \hfil
      \crcr
      \noalign{%
        \eql@hook@blockbefore
      }%
      \eql@hook@blockin
      \eql@scan@body
      \ifvmode\else
        \eql@punct@apply@block
        \eql@hook@blockout
        \eql@columns@measure@line@end
        \cr
      \fi
      \noalign{%
        \eql@hook@blockafter
      }%
      \eql@columns@completerow
      \cr
    }%
    \global\advance\eql@row@-\tw@
    \eql@numbering@measure@eval
    \ifnum\eql@numbering@target@>\z@
      \eql@tagbox@make\eql@compose@measure
      \global\eql@tagwidth@max@\eql@tagwidth@
      \global\eql@tagrows@\@ne
      \eql@tagwidth@savezero
    \fi
  }%
  \eql@totalrows@\eql@row@
  \ifdefined\eql@numbering@subeq@use
    \eql@numbering@subeq@test
  \fi
  \eql@measure@restorecounters
  \setbox\z@\vbox{%
    \unvbox\z@
    \unpenalty
    \global\setbox\@ne\lastbox
  }%
  \eql@totalwidth@\wd\@ne
  \let\eql@colwidth@tab\@empty
  \loop
    \setbox\@ne\hbox{%
      \unhbox\@ne
      \unskip
      \global\setbox\thr@@\lastbox
    }%
  \ifhbox\thr@@
    \eql@columns@colwidth@save
  \repeat
}
\def\eql@columns@print@line@begin{%
  \global\eql@column@\z@
  \global\eql@line@pos@\eql@marginleft@
  \global\eql@line@width@\z@
  \global\eql@line@avail@\eql@totalwidth@
  \global\eql@line@height@\z@
  \global\eql@line@depth@\z@
  \eql@numbering@print@line@begin
  \eql@hook@linein
}
\def\eql@columns@print@field{%
  \dimen@\eql@columns@colwidth@get\eql@column@\relax
  \ifdim\wd\eql@fieldbox@>\z@
    \ifdim\eql@line@width@=\z@
      \eql@line@avail@\eql@line@pos@
      \ifodd\eql@column@
        \advance\eql@line@avail@\dimen@
        \advance\eql@line@avail@-\wd\eql@fieldbox@
      \fi
      \global\eql@line@avail@\eql@line@avail@
    \fi
    \eql@line@width@\eql@line@pos@
    \ifodd\eql@column@
      \advance\eql@line@width@\dimen@
    \else
      \advance\eql@line@width@\wd\eql@fieldbox@
    \fi
    \global\eql@line@width@\eql@line@width@
  \fi
  \advance\eql@line@pos@\dimen@
  \ifodd\eql@column@\else
    \advance\eql@line@pos@\eql@colsep@
  \fi
  \global\eql@line@pos@\eql@line@pos@
  \ifdim\ht\eql@fieldbox@>\eql@line@height@
    \global\eql@line@height@\ht\eql@fieldbox@
  \fi
  \ifdim\dp\eql@fieldbox@>\eql@line@depth@
    \global\eql@line@depth@\dp\eql@fieldbox@
  \fi
  \dimen@\eql@columns@colwidth@get\eql@column@\relax
  \ifodd\eql@column@
    \kern\dimen@
  \else
    \advance\dimen@-\wd\eql@fieldbox@
    \box\eql@fieldbox@
    \kern\dimen@
  \fi
}
\def\eql@columns@print@trailright{%
   &\omit
    \global\advance\eql@column@\@ne
    \setbox\eql@fieldbox@\hbox{%
      \kern-\wd\eql@fieldbox@\box\eql@fieldbox@
    }%
    \eql@columns@print@field
}
\def\eql@columns@print@line@end{%
  \eql@punct@apply@line
  \eql@hook@lineout
  \ifodd\eql@column@
    \expandafter\eql@columns@print@trailright
  \fi
  \eql@columns@completerow
  \eql@columns@print@tag
}
\def\eql@columns@print@tag{%
  \dimen@\eql@totalwidth@
  \advance\dimen@\eql@colsep@
  \kern-\dimen@
  \eql@display@firstavail@set\eql@line@avail@
  \eql@print@overfull
  \eql@numbering@print@line@eval
  \if@eqnsw
    \eql@tagbox@make\eql@compose@print
    \eql@tagging@tagaddbox
    \eql@tagbox@print@multi
  \else
    \eql@tagging@tagaddbox
    \kern\displaywidth
  \fi
}
\def\eql@columns@print{%
  \eql@columns@adjust
  \eql@display@init
  \eql@numbering@print@init
  \eql@print@init\eql@columns@print@line@begin
  \eql@let@cr\eql@columns@print@line@end
  \tabskip\eql@marginleft@
  \halign{%
    &%
      \global\advance\eql@column@\@ne
      \hfil
      \global\setbox\eql@fieldbox@\hbox{%
        \eql@strut@field
        \@lign
        $\m@th\displaystyle
          \eql@hook@colin
          ##%
          \eql@class@innerleft
          \eql@hook@innerleft
          \eql@tagging@mathsave
        $%
        \eql@tagging@mathaddlast
      }%
      \global\eql@fieldwidth@\wd\eql@fieldbox@
      \eql@columns@print@field
      \tabskip\z@skip
    &%
      \global\advance\eql@column@\@ne
      \setbox\eql@fieldbox@\hbox{%
        \kern-\wd\eql@fieldbox@
        \box\eql@fieldbox@
        \eql@strut@field
        \@lign
        $\m@th\displaystyle
          \eql@hook@innerright
          \eql@class@innerright@sel
          ##%
          \eql@punct@apply@col
          \eql@hook@colout
          \eql@tagging@mathsave
        $%
        \eql@tagging@mathaddlast
      }%
      \eql@columns@print@field
      \hfil
      \tabskip\eql@colsep@\relax
    \crcr
    \noalign{%
      \eql@halign@before
      \eql@numbering@print@block@begin
      \eql@hook@blockbefore
    }%
    \eql@hook@blockin
    \eql@scan@body
    \ifvmode\else
      \eql@punct@apply@block
      \eql@hook@blockout
      \eql@columns@print@line@end
      \cr
    \fi
    \noalign{%
      \eql@hook@blockafter
      \eql@halign@after
    }%
    \eql@tagging@tablesavealign
  }%
  \eql@display@close
}
\def\eql@columns@adjust{%
  \eql@colsepmin@\glueexpr\eql@colsepmin@val\relax
  \ifodd\eql@totalcolumns@
    \advance\eql@totalcolumns@\@ne
  \fi
  \ifnum\eql@totalcolumns@<\thr@@
    \let\eql@columns@margins\eql@true
  \fi
  \eql@columns@inter@\eql@totalcolumns@
  \divide\eql@columns@inter@\tw@
  \advance\eql@columns@inter@\m@ne
  \ifdefined\eql@layoutleft
    \eql@layoutleftmargin@\glueexpr\eql@layoutleftmargin@val\relax
  \else
    \eql@adjust@tagmargin
  \fi
  \eql@colsep@\displaywidth
  \advance\eql@colsep@-\eql@totalwidth@
  \ifdefined\eql@layoutleft
    \advance\eql@colsep@-\eql@layoutleftmargin@
  \else
    \advance\eql@colsep@-\eql@tagmargin@
    \ifdefined\eql@columns@margins\else
      \ifdim\eql@tagmargin@>\z@
        \advance\eql@colsep@-\eql@tagsepmin@
      \fi
    \fi
  \fi
  \count@\eql@columns@inter@
  \ifdefined\eql@columns@margins
    \ifdefined\eql@layoutleft
      \advance\count@\@ne
    \else
      \advance\count@\tw@
    \fi
  \fi
  \divide\eql@colsep@\count@
  \ifdim\eql@colsep@<\eql@colsepmin@
    \eql@colsep@\eql@colsepmin@
  \else
    \dimen@\glueexpr\eql@colsepmax@val\relax
    \ifdim\eql@colsep@>\dimen@
      \eql@colsep@\dimen@
    \fi
  \fi
  \ifdefined\eql@layoutleft
    \ifdim\eql@colsep@=\eql@colsepmin@
      \eql@marginleft@\displaywidth
      \advance\eql@marginleft@-\eql@totalwidth@
      \advance\eql@marginleft@-\eql@columns@inter@\eql@colsep@
      \ifdim\eql@marginleft@>\eql@layoutleftmargin@
        \eql@marginleft@\eql@layoutleftmargin@
      \else
        \ifdim\eql@marginleft@<\eql@layoutleftmarginmin@
          \eql@marginleft@\eql@layoutleftmarginmin@
        \fi
      \fi
    \else
      \eql@marginleft@\eql@layoutleftmargin@
    \fi
  \else
    \ifdefined\eql@columns@margins
      \eql@marginleft@\displaywidth
      \advance\eql@marginleft@-\eql@totalwidth@
      \advance\eql@marginleft@-\eql@columns@inter@\eql@colsep@
      \ifdim\eql@marginleft@<\eql@tagmargin@
        \eql@marginleft@\z@
      \else
        \advance\eql@marginleft@-\eql@tagmargin@
        \divide\eql@marginleft@\tw@
      \fi
      \ifdefined\eql@tagsleft
        \advance\eql@marginleft@\eql@tagmargin@
      \fi
    \else
      \ifdefined\eql@tagsleft
        \eql@marginleft@\eql@tagmargin@
        \ifdim\eql@tagmargin@>\z@
          \advance\eql@marginleft@\eql@tagsepmin@
        \fi
      \else
        \eql@marginleft@\z@
      \fi
    \fi
  \fi
  \ifdefined\eql@tagsleft
    \let\eql@columns@adjust@test\eql@columns@adjust@test@tagleft
  \else
    \let\eql@columns@adjust@test\eql@columns@adjust@test@tagright
  \fi
  \eql@row@\eql@totalrows@
  \loop\ifnum\eql@row@>\z@
    \ifnum\eql@numbering@target@<\z@
      \eql@tagwidth@\eql@tagwidth@get\eql@row@\relax
    \else
      \ifnum\eql@numbering@target@=\eql@row@
        \eql@tagwidth@\eql@tagwidth@get\z@\relax
      \fi
    \fi
    \ifdim\eql@tagwidth@>\z@
      \eql@columns@adjust@calc
      \eql@columns@adjust@test
    \fi
    \advance\eql@row@\m@ne
  \repeat
  \advance\eql@totalwidth@\eql@columns@inter@\eql@colsep@
  \advance\eql@totalwidth@\eql@marginleft@
}
\def\eql@columns@adjust@calc{%
  \eql@line@pos@\z@
  \eql@column@\z@
  \eql@line@avail@\eql@totalwidth@
  \@tempcnta\eql@totalcolumns@
  \eql@line@width@\z@
  \@tempcntb\z@
  \edef\@tempb{\eql@fieldlength@get\eql@row@}%
  \@for\@tempa:=\@tempb\do
    \eql@columns@adjust@calc@col
  \advance\@tempcnta\m@ne
  \divide\@tempcnta\tw@
  \advance\@tempcntb\m@ne
  \divide\@tempcntb\tw@
}
\def\eql@columns@adjust@calc@col{%
  \advance\eql@column@\@ne
  \@tempdima\@tempa\relax
  \dimen@\eql@columns@colwidth@get\eql@column@\relax
  \ifdim\@tempdima>\z@
    \ifdim\eql@line@width@=\z@
      \eql@line@avail@\eql@line@pos@
      \@tempcnta\eql@column@
      \ifodd\eql@column@
        \advance\eql@line@avail@\dimen@
        \advance\eql@line@avail@-\@tempdima
      \fi
    \fi
    \eql@line@width@\eql@line@pos@
    \@tempcntb\eql@column@
    \ifodd\eql@column@
      \advance\eql@line@width@\dimen@
    \else
      \advance\eql@line@width@\@tempdima
    \fi
  \fi
  \advance\eql@line@pos@\dimen@
}
\def\eql@columns@adjust@test@tagright{%
  \@tempdima\displaywidth
  \advance\@tempdima-\eql@line@width@
  \advance\@tempdima-\eql@tagwidth@
  \dimen@\eql@marginleft@
  \advance\dimen@\@tempcntb\eql@colsep@
  \ifdim\dimen@>\@tempdima
    \dimen@\@tempcntb\eql@colsepmin@
    \ifdefined\eql@layoutleft
      \advance\dimen@\eql@layoutleftmarginmin@
    \fi
    \ifdim\dimen@>\@tempdima\else
      \eql@columns@adjust@modify@tagright
    \fi
  \fi
}
\def\eql@columns@adjust@modify@tagright{%
  \ifnum\@tempcntb>\z@
    \dimen@\@tempdima
    \count@\@tempcntb
    \ifdefined\eql@layoutleft
      \advance\dimen@-\eql@marginleft@
    \else
      \ifdefined\eql@columns@margins
        \advance\count@\@ne
      \fi
    \fi
    \divide\dimen@\count@
    \ifdim\dimen@<\eql@colsep@
      \ifdim\dimen@<\eql@colsepmin@
        \dimen@\eql@colsepmin@
      \fi
      \eql@colsep@\dimen@
    \fi
  \fi
  \dimen@\@tempdima
  \advance\dimen@-\@tempcntb\eql@colsep@
  \ifdim\dimen@<\eql@marginleft@
    \eql@marginleft@\dimen@
  \fi
}
\def\eql@columns@adjust@test@tagleft{%
  \count@\eql@columns@inter@
  \advance\count@-\@tempcnta
  \@tempdima\eql@tagwidth@
  \advance\@tempdima-\eql@line@avail@
  \dimen@\eql@marginleft@
  \advance\dimen@\@tempcnta\eql@colsep@
  \ifdim\dimen@<\@tempdima
    \ifdefined\eql@layoutleft
      \dimen@\eql@layoutleftmarginmax@
    \else
      \dimen@\displaywidth
    \fi
    \ifdim\dimen@>\eql@tagwidth@
      \dimen@\count@\eql@colsepmin@
      \advance\dimen@\eql@totalwidth@
      \advance\dimen@\@tempdima
      \ifdim\dimen@>\displaywidth\else
        \eql@columns@adjust@modify@tagleft
      \fi
    \fi
  \fi
}
\def\eql@columns@adjust@modify@tagleft{%
  \ifnum\count@>\z@
    \dimen@\displaywidth
    \advance\dimen@-\eql@totalwidth@
    \advance\dimen@-\@tempdima
    \ifdefined\eql@columns@margins
      \advance\count@\@ne
    \fi
    \divide\dimen@\count@
    \ifdim\dimen@<\eql@colsep@
      \ifdim\dimen@<\eql@colsepmin@
        \dimen@\eql@colsepmin@
      \fi
      \advance\dimen@-\eql@colsep@
      \advance\eql@marginleft@-\eql@columns@inter@\dimen@
      \advance\eql@colsep@\dimen@
    \fi
  \fi
  \dimen@-\@tempcnta\eql@colsep@
  \advance\dimen@\@tempdima
  \ifdim\dimen@>\eql@marginleft@
    \eql@marginleft@\dimen@
  \fi
}
\newtoks\eql@scan@reg@
\def\eql@scan@body@dump{\the\eql@scan@reg@}
\def\eql@scan@body@rescan{%
  \expandafter\scantokens\expandafter{\the\eql@scan@reg@}}
\let\eql@scan@body\eql@scan@body@dump
\long\def\eql@scan@addto#1{\eql@scan@reg@\expandafter{\the\eql@scan@reg@#1}}
\def\eql@scan@env#1{%
  \def\eql@scan@end{#1\expandafter\end\expandafter{\@currenvir}}%
  \eql@scan@reg@{}\def\eql@scan@stack{b}%
  \edef\eql@scan@iterate{\expandafter\noexpand\csname\@currenvir\endcsname}%
  \expandafter\let\expandafter\eql@scan@env@org\eql@scan@iterate
  \expandafter\let\eql@scan@iterate\eql@scan@env@iterate
  \eql@scan@iterate
}
\def\eql@scan@env@iterate#1\end#2{%
  \edef\eql@scan@stack{%
    \eql@scan@env@count#1\begin\end\expandafter\@gobble\eql@scan@stack}%
  \ifx\@empty\eql@scan@stack
    \@checkend{#2}%
    \eql@scan@addto{#1}%
    \expandafter\let\eql@scan@iterate\eql@scan@env@org
    \expandafter\eql@scan@end
  \else
    \eql@scan@addto{#1\end{#2}}%
    \expandafter\eql@scan@iterate
  \fi
}
\long\def\eql@scan@env@count#1\begin#2{%
  \ifx\end#2\else b\expandafter\eql@scan@env@count\fi
}
\def\eql@scan@env@cancel{%
  \@namedef{end\@currenvir}{\ignorespacesafterend}%
}
\def\eql@scan@sqr#1{%
  \def\eql@scan@end{#1\]}%
  \eql@scan@reg@{}\def\eql@scan@stack{b}%
  \let\eql@scan@sqr@org\[%\]
  \let\[\eql@scan@sqr@iterate%\]
  \[%\]
}
\def\eql@scan@sqr@iterate#1\]{%
  \edef\eql@scan@stack{%
    \eql@scan@sqr@count#1\[\]\expandafter\@gobble\eql@scan@stack}%
  \ifx\@empty\eql@scan@stack
    \let\[\eql@scan@sqr@org%\]
    \eql@scan@addto{#1}%
    \expandafter\eql@scan@end
  \else
    \eql@scan@addto{#1\]}%
    \expandafter\[%\]
  \fi
}
\long\def\eql@scan@sqr@count#1\[#2{%\]
  \ifx\]#2\else b\expandafter\eql@scan@sqr@count\fi
}
\def\eql@scan@sqrang@cancel{\expandafter\ignorespaces\@gobble}
\def\eql@scan@ang#1{%
  \def\eql@scan@end{#1\>}%
  \eql@scan@reg@{}\def\eql@scan@stack{b}%
  \let\eql@scan@ang@org\<%\>
  \let\<\eql@scan@ang@iterate%\>
  \<%\>
}
\def\eql@scan@ang@iterate#1\>{%
  \edef\eql@scan@stack{%
    \eql@scan@ang@count#1\<\>\expandafter\@gobble\eql@scan@stack}%
  \ifx\@empty\eql@scan@stack
    \let\<\eql@scan@ang@org%\>
    \eql@scan@addto{#1}%
    \expandafter\eql@scan@end
  \else
    \eql@scan@addto{#1\>}%
    \expandafter\<%\>
  \fi
}
\long\def\eql@scan@ang@count#1\<#2{%\>
  \ifx\>#2\else b\expandafter\eql@scan@ang@count\fi
}
\def\eql@equations@testall{\eql@equations@testtilde}
\def\eql@equations@testtilde#1{%
  \eql@ifnextgobble@tight~%
    {\eqnaddopt{lines}\eql@equations@testopt{#1}}%
    {\eql@equations@testopt{#1}}}
\def\eql@equations@testopt#1{%
  \eql@ifnextchar@tight[%]
    {\eql@equations@addopt{\eql@equations@testexcl{#1}}}%
    {\eql@equations@testexcl{#1}}}
\def\eql@equations@addopt#1[#2]{\eqnaddopt{#2}#1}
\def\eql@equations@testexcl#1{%
  \eql@ifnextgobble@tight!%
    {\eqnaddopt{donumber}\eql@equations@testat{#1}}%
    {\eql@equations@teststar{#1}}}
\def\eql@equations@teststar#1{%
  \eql@ifstar@tight%
    {\eqnaddopt{nonumber}\eql@equations@testat{#1}}%
    {\eql@equations@testat{#1}}}
\def\eql@equations@testat#1{%
  \eql@ifat@tight
    {\eql@equations@addlabel{#1}}%
    {#1}}
\def\eql@equations@addlabel#1#2{\eqnaddopt{label={#2}}#1}
\def\eql@equations@processopt{%
  \let\eql@blocklabel\@undefined
  \let\eql@blocktag\@undefined
  \let\eql@skip@force@above\@undefined
  \let\eql@skip@force@below\@undefined
  \let\eql@skip@force@leave\@undefined
  \eql@abovespace@\z@skip
  \eql@belowspace@\z@skip
  \eql@displaybreak@prepen@\@MM
  \eql@nextopt@process{equations}%
  \let\eql@punct@block\eql@punct@main
  \let\eql@punct@main\relax
  \eql@indent@\glueexpr\eql@indent@val\relax
  \eql@tagsepmin@\glueexpr\eql@tagsepmin@val\relax
}
\def\eql@single@cr{%
  \eql@error{Cannot use `\string\\' within display equation.
    Please switch to equations environment}%
}
\def\eql@single@start{%
  \eql@halign@catchprevdepth
  \eql@tagging@start
  \eql@dollardollar@begin
  \eql@numbering@eval@mode
  \let\eql@numbering@subeq@use\eql@false
  \eql@stack@save@single
  \eql@numbering@single@init
  \ifdefined\eql@single@native
    \let\eql@single@start@sel\eql@single@start@native
    \let\eql@single@end@sel\eql@single@end@native
    \let\raisetag\eql@raisetag@default
  \else
    \let\eql@single@start@sel\eql@single@start@print
    \let\eql@single@end@sel\eql@single@end@print
  \fi
  \ifdefined\eql@single@crerror\else
    \let\\\eql@single@cr
  \fi
  \eql@single@start@sel
}
\def\eql@single@end{%
  \eql@punct@apply@block
  \eql@hook@eqout
  \eql@single@end@sel
  \eql@stack@restore
  \eql@dollardollar@end
  \eql@tagging@end
  \eql@halign@leave
}
\def\eql@single@main{%
  \expandafter\eql@single@start
  \eql@scan@body
  \eql@single@end
}
\def\eql@mode@equation{%
  \ifdefined\eql@single@doscan
    \let\eql@equations@main\eql@single@main
    \let\eql@equations@end\@empty
  \else
    \let\eql@equations@main\@undefined
    \let\eql@equations@end\eql@single@end
  \fi
}
\let\eql@multi@mode@lines\eql@false
\def\eql@multi@main{%
  \eql@halign@catchprevdepth
  \eql@tagging@start
  \eql@dollardollar@begin
  \eql@numbering@eval@mode
  \eql@stack@save@multi
  \ifdefined\eql@subequations@active
    \let\eql@numbering@subeq@use\eql@false
  \fi
  \ifdefined\eql@numbering@subeq@use
    \eql@numbering@subeq@init
  \fi
  \let\intertext\eql@intertext
  \let\endintertext\endeql@intertext
  \let\shoveleft\eql@adjust@alignleft
  \let\shovecenter\eql@adjust@aligncenter
  \let\shoveright\eql@adjust@alignright
  \ifdefined\eql@multi@mode@lines
    \expandafter\eql@lines@measure
  \else
    \ifdefined\eql@ampproof@active
      \eql@ampproof
    \fi
    \expandafter\eql@columns@measure
  \fi
  \ifx\eql@numbering@subeq@use\@ne
    \eql@numbering@subeq@revert
  \fi
  \ifdefined\eql@multi@mode@lines\else
    \ifdefined\eql@multi@linesfallback
      \ifnum\eql@totalcolumns@=\@ne
        \let\eql@multi@mode@lines\eql@true
      \fi
    \fi
  \fi
  \ifdefined\eql@multi@mode@lines
    \expandafter\eql@lines@print
  \else
    \expandafter\eql@columns@print
  \fi
  \ifdefined\eql@numbering@subeq@use
    \eql@numbering@subeq@close
  \fi
  \eql@stack@restore
  \eql@dollardollar@end
  \eql@tagging@end
  \eql@halign@leave
}
\def\eql@mode@columns{%
  \let\eql@equations@main\eql@multi@main
  \let\eql@equations@end\@empty
  \let\eql@multi@mode@lines\eql@false
}
\def\eql@mode@lines{%
  \let\eql@equations@main\eql@multi@main
  \let\eql@equations@end\@empty
  \let\eql@multi@mode@lines\eql@true
}
\newenvironment{equations}{%
  \ifmmode
    \eql@error@mathmode{\string\begin{\@currenvir}}%
    \expandafter\eql@scan@env\expandafter\eql@scan@env@cancel
  \else
    \expandafter\eql@ampprotect\expandafter\eql@equations@testall
      \expandafter\eql@equations@start
  \fi
}{%
  \eql@equations@end
  \ignorespacesafterend
}
\def\eql@equations@start{%
  \eql@equations@processopt
  \ifdefined\eql@equations@main
    \expandafter\eql@scan@env\expandafter\eql@equations@main
  \else
    \expandafter\eql@single@start
  \fi
}
\newenvironment{equations@sqr}{}{}
\protected\def\eql@equations@sqr@open{%
  \ifmmode
    \eql@error@mathmode{\string\[...\string\]}%
    \expandafter\eql@scan@sqr\expandafter\eql@scan@sqrang@cancel
  \else
    \expandafter\eqnaddopt\expandafter{\eql@equations@sqr@opt}%
    \begin{equations@sqr}%
    \expandafter\eql@ampprotect\expandafter\eql@equations@testall
      \expandafter\eql@equations@sqr@start
  \fi
}
\def\eql@equations@sqr@start{%
  \eql@equations@processopt
  \ifdefined\eql@equations@main
    \expandafter\eql@scan@sqr\expandafter\eql@equations@main
  \else
    \expandafter\eql@single@start
  \fi
}
\protected\def\eql@equations@sqr@close{%
  \eql@equations@end
  \end{equations@sqr}%
  \ignorespaces
}
\newenvironment{equations@ang}{}{}
\protected\def\eql@equations@ang@open{%
  \ifmmode
    \eql@error@mathmode{\string\<...\string\>}%
    \expandafter\eql@scan@ang\expandafter\eql@scan@sqrang@cancel
  \else
    \expandafter\eqnaddopt\expandafter{\eql@equations@ang@opt}%
    \begin{equations@ang}%
    \expandafter\eql@ampprotect\expandafter\eql@equations@testall
      \expandafter\eql@equations@ang@start
  \fi
}
\def\eql@equations@ang@start{%
  \eql@equations@processopt
  \ifdefined\eql@equations@main
    \expandafter\eql@scan@ang\expandafter\eql@equations@main
  \else
    \expandafter\eql@single@start
  \fi
}
\protected\def\eql@equations@ang@close{%
  \eql@equations@end
  \end{equations@ang}%
  \ignorespaces
}
\RequirePackage{keyval}
\def\eql@decide@select#1#2#3#4{%
  \def\@tempa{#3}%
  \let\@tempd\@undefined
  \@for\@tempc:=#4\do{%
    \ifdefined\@tempd\else
      \edef\@tempb{\noexpand\@tempb:=\expandafter\@firstoftwo\@tempc}%
      \expandafter\@for\@tempb\do{%
        \ifx\@tempa\@tempb
          \expandafter\expandafter\expandafter\def
          \expandafter\expandafter\expandafter\@tempd
          \expandafter\expandafter\expandafter{%
          \expandafter\@secondoftwo\@tempc}%
        \fi
      }%
    \fi
  }%
  \ifdefined\@tempd
    \@tempd
  \else
    \eql@error{undefined value `#3' for option `#2' of `#1'}%
  \fi
}
\def\eql@decide@if#1#2#3#4#5{%
  \eql@decide@select{#1}{#2}{#3}{%
    {{on,true,yes,enabled,1}{#4}},%
    {{off,false,no,disabled,0}{#5}}}}
\def\eql@decide@bool#1#2#3#4{%
  \eql@decide@if{#1}{#2}{#3}{\let#4\eql@true}{\let#4\eql@false}}
\def\eql@decide@abovebelow#1#2#3#4#5{%
  \eql@decide@select{#1}{#2}{#3}{%
    {,abovebelow,both,tb}{#4#5},%
    {above,top,t}{#4},%
    {below,bottom,b}{#5}}}
\def\eql@decide@situation#1#2#3#4{%
  \eql@decide@select{#1}{#2}{#3}{%
    {{long}{\def#4{0}}},%
    {{short}{\def#4{1}}},%
    {{cont}{\def#4{2}}},%
    {{par}{\def#4{3}}},%
    {{top}{\def#4{4}}},%
    {{noskip}{\def#4{5}}},%
    {{medskip}{\def#4{6}}}}}
\def\eql@define@key#1#2{%
  \eql@ifnextchar@loose[%]
    {\eql@definekey@opt{#1}{#2}}%
    {\eql@definekey@noopt{#1}{#2}}%
}
\def\eql@definekey@noopt#1#2#3{\eql@definekey@for{#1}{#2}{{#3}}}
\def\eql@definekey@opt#1#2[#3]#4{\eql@definekey@for{#1}{#2}{[#3]{#4}}}
\def\eql@definekey@for#1#2#3{%
  \def\eql@for@fn##1##2##3{\define@key{eql@##3}{##2}#3}%
  \edef\eql@for@vara{\noexpand\eql@for@vara:=#1}%
  \expandafter\@for\eql@for@vara\do{%
    \edef\eql@for@varb{\noexpand\eql@for@varb:=#2}%
    \expandafter\@for\eql@for@varb\do{%
      \edef\eql@for@call##1{%
        \noexpand\eql@for@fn{##1}{\eql@for@varb}{\eql@for@vara}}%
      \eql@for@call{##1}%
    }%
  }%
}
\def\eql@setkeys#1#2{%
  \def\eql@tmp{\setkeys{eql@#1}}%
  \expandafter\eql@tmp\expandafter{#2}%
}
\let\eql@nextopt\@empty
\def\eql@nextopt@process#1{%
  \eql@setkeys{#1}\eql@nextopt
  \let\eql@tagging@opt\eql@nextopt
  \global\let\eql@nextopt\@empty
}
\newcommand{\eqnaddopt}[1]{%
  \expandafter\def\expandafter\eql@nextopt\expandafter{\eql@nextopt,#1}}
\eql@define@key{equationsbox}{gathered,gather,ga,lines,ln,\string~}[]{%
  \eql@mode@stacked}
\eql@define@key{equationsbox}{aligned,align,al,columns,col,@}[]{%
  \eql@mode@aligned}
\eql@define@key{equationsbox}{top,t}[]{\let\eql@box@box\vtop}
\eql@define@key{equationsbox}{center,c}[]{\let\eql@box@box\vcenter}
\eql@define@key{equationsbox}{bottom,b}[]{\let\eql@box@box\vbox}
\eql@define@key{equationsbox}{colsep}{\def\eql@box@colsep{#1}}
\eql@define@key{equations}{equation,eq,single,1}[]{\eql@mode@equation}
\eql@define@key{equations}{gathered,gather,ga,lines,ln,\string~}[]{%
  \eql@mode@lines}
\eql@define@key{equations}{aligned,align,al,columns,col,@}[]{%
  \eql@mode@columns}
\eql@define@key{equations}{native}[true]{%
  \eql@decide@bool{#3}{#2}{#1}\eql@single@native%
  \ifdefined\eql@single@native\let\eql@layoutleft\eql@false\fi}
\eql@define@key{setup}{native}[true]{%
  \eql@decide@bool{#3}{#2}{#1}\eql@single@native}
\eql@define@key{setup}{scanequation}[true]{%
  \eql@decide@bool{#3}{#2}{#1}\eql@single@doscan}
\eql@define@key{setup}{sqropt}[]{%
  \def\eql@equations@sqr@opt{equation,#1}}
\eql@define@key{setup}{angopt}[]{%
  \def\eql@equations@ang@opt{align,#1}}
\def\eql@keycat{equations,equationsbox,setup}
\eql@define@key\eql@keycat{spread}{\def\eql@spread@val{#1}}
\eql@define@key\eql@keycat{strut}[true]{\eql@decide@if{#3}{#2}{#1}%
  {\let\eql@strut@field\eql@strut}{\let\eql@strut@field\relax}}
\eql@define@key\eql@keycat{struttag}[true]{\eql@decide@if{#3}{#2}{#1}%
  {\let\eql@strut@tag\eql@strut}{\let\eql@strut@tag\relax}}
\eql@define@key{equations}{displaybreak}[4]{\eql@displaybreak@pre{#1}}
\def\eql@keycat{equations,setup}
\eql@define@key\eql@keycat{allowbreaks,allowdisplaybreaks}[4]{%
  \interdisplaylinepenalty\eql@getdsp@pen{#1}\relax}
\eql@define@key\eql@keycat{displayheight}[\ht\eql@strutbox@]{%
  \def\eql@display@height{#1}}
\eql@define@key\eql@keycat{displaydepth}[\dp\eql@strutbox@]{%
  \def\eql@display@depth{#1}}
\eql@define@key\eql@keycat{displayheight*}[]{%
  \let\eql@display@height\@undefined}
\eql@define@key\eql@keycat{displaydepth*}[]{%
  \let\eql@display@depth\@undefined}
\eql@define@key{equations}{noskip}[]{%
  \eql@decide@abovebelow{#3}{#2}{#1}%
    {\def\eql@skip@force@above{5}}%
    {\def\eql@skip@force@below{5}}}
\eql@define@key{equations}{short}[above]{%
  \eql@decide@abovebelow{#3}{#2}{#1}%
    {\def\eql@skip@force@above{1}}%
    {\def\eql@skip@force@below{1}}}
\eql@define@key{equations}{long}[]{%
  \eql@decide@abovebelow{#3}{#2}{#1}%
    {\def\eql@skip@force@above{0}}%
    {\def\eql@skip@force@below{0}}}
\eql@define@key{equations}{medskip}[]{%
  \eql@decide@abovebelow{#3}{#2}{#1}%
    {\def\eql@skip@force@above{6}}%
    {\def\eql@skip@force@below{6}}}
\eql@define@key{equations}{par}[par]{%
  \eql@decide@select{#3}{#2}{#1}{%
    {{default,}{\let\eql@skip@force@leave\@undefined}},%
    {{cont,hmode}{\let\eql@skip@force@leave\z@}},%
    {{par,vmode}{\let\eql@skip@force@leave\@ne
      \ifdefined\eql@skip@force@below\else
        \def\eql@skip@force@below{3}%
      \fi}},%
    {{top}{\let\eql@skip@force@leave\tw@
      \ifdefined\eql@skip@force@below\else
        \def\eql@skip@force@below{4}
      \fi}}}}
\eql@define@key{equations}{skip}{%
  \def\eql@skip@force@above{7}%
  \def\eql@skip@custom@above{#1}%
  \let\eql@skip@force@below\eql@skip@force@above
  \let\eql@skip@custom@below\eql@skip@custom@above}
\eql@define@key{equations}{aboveskip}{%
  \def\eql@skip@force@above{7}%
  \def\eql@skip@custom@above{#1}}
\eql@define@key{equations}{belowskip}{%
  \def\eql@skip@force@below{7}%
  \def\eql@skip@custom@below{#1}}
\eql@define@key{equations}{abovespace}{%
  \advance\eql@abovespace@\glueexpr#1\relax}
\eql@define@key{equations}{belowspace}{%
  \advance\eql@belowspace@\glueexpr#1\relax}
\eql@define@key{intertext}{skip}{%
  \def\eql@skip@force@above{7}%
  \def\eql@skip@custom@above{#1}%
  \let\eql@skip@force@below\eql@skip@force@above
  \let\eql@skip@custom@below\eql@skip@custom@above}
\eql@define@key{intertext}{aboveskip}{%
  \def\eql@skip@force@below{7}%
  \def\eql@skip@custom@below{#1}}
\eql@define@key{intertext}{belowskip}{%
  \def\eql@skip@force@above{7}%
  \def\eql@skip@custom@above{#1}}
\eql@define@key{intertext}{noskip}[]{%
  \eql@decide@abovebelow{#3}{#2}{#1}%
    {\def\eql@skip@force@below{5}}%
    {\def\eql@skip@force@above{5}}}
\eql@define@key{intertext}{short}[]{%
  \eql@decide@abovebelow{#3}{#2}{#1}%
    {\def\eql@skip@force@below{1}}%
    {\def\eql@skip@force@above{1}}}
\eql@define@key{intertext}{long}[]{%
  \eql@decide@abovebelow{#3}{#2}{#1}%
    {\def\eql@skip@force@below{0}}%
    {\def\eql@skip@force@above{0}}}
\eql@define@key{intertext}{medskip}[]{%
  \eql@decide@abovebelow{#3}{#2}{#1}%
    {\def\eql@skip@force@below{6}}%
    {\def\eql@skip@force@above{6}}}
\eql@define@key{setup}{skip,longskip}{%
  \abovedisplayskip\glueexpr#1\relax
  \belowdisplayskip\abovedisplayskip
  \def\eql@skip@long@above{#1}%
  \let\eql@skip@long@below\eql@skip@long@above}
\eql@define@key{setup}{aboveskip,abovelongskip}{%
  \abovedisplayskip\glueexpr#1\relax
  \def\eql@skip@long@above{#1}}
\eql@define@key{setup}{belowskip,belowlongskip}{%
  \belowdisplayskip\glueexpr#1\relax
  \def\eql@skip@long@below{#1}}
\eql@define@key{setup}{aboveshortskip}{%
  \abovedisplayshortskip\glueexpr#1\relax
  \def\eql@skip@short@above{#1}}
\eql@define@key{setup}{belowshortskip}{%
  \belowdisplayshortskip\glueexpr#1\relax
  \def\eql@skip@short@below{#1}}
\eql@define@key{setup}{tagskip}{%
  \def\eql@skip@tag@above{#1}%
  \let\eql@skip@tag@below\eql@skip@tag@above}
\eql@define@key{setup}{abovetagskip}{%
  \def\eql@skip@tag@above{#1}}
\eql@define@key{setup}{belowtagskip}{%
  \def\eql@skip@tag@below{#1}}
\eql@define@key{setup}{medskip}{%
  \def\eql@skip@med@above{#1}%
  \let\eql@skip@med@below\eql@skip@med@above}
\eql@define@key{setup}{abovemedskip}{%
  \def\eql@skip@med@above{#1}}
\eql@define@key{setup}{belowmedskip}{%
  \def\eql@skip@med@below{#1}}
\eql@define@key{setup}{medtagskip}{%
  \def\eql@skip@medtag@above{#1}%
  \let\eql@skip@medtag@below\eql@skip@medtag@above}
\eql@define@key{setup}{abovemedtagskip}{%
  \def\eql@skip@medtag@above{#1}}
\eql@define@key{setup}{belowmedtagskip}{%
  \def\eql@skip@medtag@below{#1}}
\eql@define@key{setup}{abovetopskip}{%
  \def\eql@skip@top@above{#1}}
\eql@define@key{setup}{belowtopskip}{%
  \def\eql@skip@top@below{#1}}
\eql@define@key{setup}{aboveparskip}{%
  \def\eql@skip@par@above{#1}}
\eql@define@key{setup}{belowparskip}{%
  \def\eql@skip@par@below{#1}}
\eql@define@key{setup}{abovepartagskip}{%
  \def\eql@skip@partag@above{#1}}
\eql@define@key{setup}{belowpartagskip}{%
  \def\eql@skip@partag@below{#1}}
\eql@define@key{setup}{abovecontskip}{%
  \def\eql@skip@cont@above{#1}}
\eql@define@key{setup}{abovecontskip*}[]{%
  \def\eql@skip@cont@above{\eql@spread@val-\eql@skip@long@below}}
\eql@define@key{setup}{belowcontskip}{%
  \def\eql@skip@cont@below{#1}}
\eql@define@key{setup}{shortmode}{%
  \eql@decide@select{#3}{#2}{#1}{%
    {{off,never,no}{\def\eql@skip@mode@short{0}}},%
    {{above,neverbelow,notbelow,belowoff}{\def\eql@skip@mode@short{1}}},%
    {{belowone,belowsingle}{\def\eql@skip@mode@short{2}}},%
    {{belowall,always,on}{\def\eql@skip@mode@short{3}}}}}
\eql@define@key{setup}{abovecontmode}{%
  \eql@decide@situation{#3}{#2}{#1}\eql@skip@mode@cont@above}
\eql@define@key{setup}{belowcontmode}{%
  \eql@decide@situation{#3}{#2}{#1}\eql@skip@mode@cont@below}
\eql@define@key{setup}{aboveparmode}{%
  \eql@decide@situation{#3}{#2}{#1}\eql@skip@mode@par@above}
\eql@define@key{setup}{belowparmode}{%
  \eql@decide@situation{#3}{#2}{#1}\eql@skip@mode@par@below}
\eql@define@key{setup}{abovetopmode}{%
  \eql@decide@situation{#3}{#2}{#1}\eql@skip@mode@top@above}
\eql@define@key{setup}{belowtopmode}{%
  \eql@decide@situation{#3}{#2}{#1}\eql@skip@mode@top@below}
\def\eql@keycat{equations,subequations}
\eql@define@key\eql@keycat{label}{\eql@blocklabel@set{#1}}
\eql@define@key\eql@keycat{tag}{\eql@blocktag@set{#1}}
\eql@define@key\eql@keycat{tag*}{\eql@blocktag@setstar{#1}}
\def\eql@keycat{equations,setup}
\eql@define@key\eql@keycat{tagmargin}[]{\def\eql@tagmargin@val{#1}
  \ifx\eql@tagmargin@val\@empty\let\eql@tagmargin@val\@undefined\fi}
\eql@define@key\eql@keycat{tagmargin*}{%
  \settowidth\dimen@{#1}\edef\eql@tagmargin@val{\the\dimen@}}
\eql@define@key\eql@keycat{tagmarginratio}{%
  \eql@tagmargin@ratio@\dimexpr#1pt\relax}
\eql@define@key\eql@keycat{tagmarginthreshold}{%
  \def\eql@tagmargin@threshold{#1}}
\eql@define@key\eql@keycat{mintagsep}{\def\eql@tagsepmin@val{#1}}
\eql@define@key\eql@keycat{mintagwidth}{%
  \settowidth\dimen@{#1}\edef\eql@tagsepmin@val{\the\dimen@}}
\eql@define@key\eql@keycat{mintagwidth*}{\settowidth\eql@tagwidthmin@{#1}}
\eql@define@key{setup}{tagbox,taglayout}{\eql@tag@setbox{#1}}
\eql@define@key{setup}{tagbox,taglayout*}{\eql@tag@setbox@{#1}}
\eql@define@key{setup}{tagform}{\eql@tag@setform#1}
\eql@define@key{setup}{tagform*}{\eql@tag@setform@{#1}}
\eql@define@key{setup}{subeqtemplate}{%
  \def\eql@subequations@template####1####2{#1}%
  \expandafter\def\expandafter\eql@subequations@template\expandafter{%
    \eql@subequations@template\theparentequation{equation}}%
}
\eql@define@key{setup}{autolabel}[true]{%
  \eql@decide@bool{#3}{#2}{#1}\eql@numbering@autolabel}
\eql@define@key{setup}{autotag}[true]{%
  \eql@decide@bool{#3}{#2}{#1}\eql@numbering@autotag}
\def\eql@keycat{equations,setup}
\eql@define@key\eql@keycat{numberline,numline,n}[all]{%
  \eql@numbering@set{##1}}
\eql@define@key\eql@keycat{nonumber,nn,*}[]{%
  \let\eql@numbering@active\eql@false}
\eql@define@key\eql@keycat{donumber,dn,!}[]{%
  \let\eql@numbering@active\eql@true}
\eql@define@key\eql@keycat{number,num}[true]{%
  \eql@decide@bool{#3}{#2}{#1}\eql@numbering@active}
\eql@define@key\eql@keycat{tagsleft,leqno}[]{\let\eql@tagsleft\eql@true}
\eql@define@key\eql@keycat{tagsright,reqno}[]{\let\eql@tagsleft\eql@false}
\eql@define@key\eql@keycat{tags,eqno}{%
  \eql@decide@select{#3}{#2}{#1}{%
    {{right,r}{\let\eql@tagsleft\eql@false}},%
    {{left,l}{\let\eql@tagsleft\eql@true}}}}
\def\eql@keycat{equations,setup}
\eql@define@key\eql@keycat{layout}{\eql@decide@select{#3}{#2}{#1}{%
  {{center,c}{\let\eql@layoutleft\eql@false}},%
  {{left,l}{\let\eql@layoutleft\eql@true}}}}
\eql@define@key\eql@keycat{center}[]{\let\eql@layoutleft\eql@false}
\eql@define@key\eql@keycat{flushleft,left}[]{\let\eql@layoutleft\eql@true}
\eql@define@key\eql@keycat{leftmargin}{\def\eql@layoutleftmargin@val{#1}}
\eql@define@key\eql@keycat{leftmargin*}{%
  \settowidth\dimen@{#1}\edef\eql@layoutleftmargin@val{\the\dimen@}}
\eql@define@key\eql@keycat{minleftmargin}{%
  \eql@layoutleftmarginmin@\glueexpr#1\relax}
\eql@define@key\eql@keycat{maxleftmargin}{%
  \eql@layoutleftmarginmax@\glueexpr#1\relax}
\eql@define@key\eql@keycat{maxleftmargin*}[]{%
  \eql@layoutleftmarginmax@.5\maxdimen}
\def\eql@keycat{equations,setup}
\eql@define@key\eql@keycat{marginbadness}{\eql@marginbadness@#1\relax}
\eql@define@key\eql@keycat{maxbadness}{\eql@maxbadness@#1\relax}
\eql@define@key\eql@keycat{mincolsep}{\def\eql@colsepmin@val{#1}}
\eql@define@key\eql@keycat{maxcolsep}{\def\eql@colsepmax@val{#1}}
\eql@define@key\eql@keycat{maxcolsep*}[]{\def\eql@colsepmax@val{.5\maxdimen}}
\eql@define@key\eql@keycat{margins}[true]{%
  \eql@decide@bool{#3}{#2}{#1}\eql@columns@margins}
\def\eql@keycat{equationsbox,setup}
\eql@define@key\eql@keycat{margin}{%
  \def\eql@box@marginleft{#1}\def\eql@box@marginright{#1}}
\eql@define@key\eql@keycat{marginleft}{\def\eql@box@marginleft{#1}}
\eql@define@key\eql@keycat{marginright}{\def\eql@box@marginright{#1}}
\def\eql@keycat{equations,equationsbox,setup}
\eql@define@key\eql@keycat{shape}[default]{\eql@shape@set{#1}}
\eql@define@key\eql@keycat{padding,pad}[\eql@indent@val]{%
  \let\eql@paddingmax\eql@false
  \def\eql@paddingleft@val{#1}\def\eql@paddingright@val{#1}}
\eql@define@key\eql@keycat{padleft}[\eql@indent@val]{%
  \let\eql@paddingmax\eql@false\def\eql@paddingleft@val{#1}}
\eql@define@key\eql@keycat{padright}[\eql@indent@val]{%
  \let\eql@paddingmax\eql@false\def\eql@paddingright@val{#1}}
\eql@define@key\eql@keycat{padmax}[true]{%
  \eql@decide@bool{#3}{#2}{#1}\eql@paddingmax}
\eql@define@key\eql@keycat{indent}[2em]{%
  \def\eql@indent@val{#1}}
\eql@define@key\eql@keycat{indent*}[2em]{%
  \def\eql@indent@val{#1}\def\eql@paddingleft@val{#1}}
\def\eql@keycat{equations,equationsbox,setup}
\eql@define@key\eql@keycat{classout}{\eql@class@innerleft@set{#1}}
\eql@define@key\eql@keycat{classin}{\eql@class@innerright@set{#1}}
\eql@define@key\eql@keycat{classlead,classin*}{\eql@class@innerlead@set{#1}}
\eql@define@key\eql@keycat{ampeq}[]{\eql@class@ampeq}
\eql@define@key\eql@keycat{eqamp}[]{\eql@class@eqamp}
\eql@define@key\eql@keycat{class}{\eql@decide@select{#3}{#2}{#1}{%
  {{ampeq,amprel,eqafter,beforerel}\eql@class@ampeq},%
  {{eqamp,relamp,eqbefore,afterrel}\eql@class@eqamp}}}
\let\eql@punct@main\relax
\def\eql@keycat{equations,equationsbox,setup}
\eql@define@key\eql@keycat{punctsep}[\,]{\def\eql@punct@sep{#1}}
\eql@define@key\eql@keycat{punct}[.]{\def\eql@punct@main{#1}}
\eql@define@key\eql@keycat{punctline}[,]{\def\eql@punct@line{#1}}
\eql@define@key\eql@keycat{punctcol}[,]{\def\eql@punct@col{#1}}
\eql@define@key\eql@keycat{punct*}[]{\let\eql@punct@main\relax}
\eql@define@key\eql@keycat{punctline*}[]{\let\eql@punct@line\relax}
\eql@define@key\eql@keycat{punctcol*}[]{\let\eql@punct@col\relax}
\let\eql@multi@linesfallback\eql@true
\let\eql@single@crerror\eql@true
\let\eql@ampproof@active\eql@false
\eql@define@key{setup}{linesfallback}[true]{%
  \eql@decide@bool{#3}{#2}{#1}\eql@multi@linesfallback}
\eql@define@key{setup}{ampproof}[true]{%
  \eql@decide@bool{#3}{#2}{#1}\eql@ampproof@active}
\eql@define@key{setup}{crerror}[true]{%
  \eql@decide@bool{#3}{#2}{#1}\eql@single@crerror}
\eql@define@key{equations,setup}{rescan}[true]{%
  \eql@decide@if{#3}{#2}{#1}%
    {\let\eql@scan@body\eql@scan@body@rescan}%
    {\let\eql@scan@body\eql@scan@body@dump}}
\eql@define@key{setup}{defaults}{%
  \eql@decide@select{#3}{#2}{#1}{%
    {{classic}{\eql@defaults@classic}},%
    {{eqnlines}{\eql@defaults@eqnlines}}}}
\let\eql@provide@opt@equation\eql@true
\let\eql@provide@opt@amsmathends\eql@true
\let\eql@provide@opt@amsmath\eql@true
\let\eql@provide@opt@ang\eql@true
\let\eql@provide@opt@eqref\eql@true
\eql@define@key{setup}{equation}[true]{%
  \eql@error@packageoption{#2}%
  \eql@decide@bool{#3}{#2}{#1}\eql@provide@opt@equation}
\eql@define@key{setup}{amsmathends}[true]{%
  \eql@error@packageoption{#2}%
  \eql@decide@bool{#3}{#2}{#1}\eql@provide@opt@amsmathends}
\eql@define@key{setup}{amsmath}[true]{%
  \eql@error@packageoption{#2}%
  \eql@decide@bool{#3}{#2}{#1}\eql@provide@opt@amsmath}
\eql@define@key{setup}{ang}[true]{%
  \eql@error@packageoption{#2}%
  \eql@decide@bool{#3}{#2}{#1}\eql@provide@opt@ang}
\eql@define@key{setup}{eqref}[true]{%
  \eql@error@packageoption{#2}%
  \eql@decide@bool{#3}{#2}{#1}\eql@provide@opt@eqref}
\def\eql@defaults@classic{%
  \eqnlinesset{mintagsep={.5\fontdimen6\textfont2\relax}}%
  \eqnlinesset{maxcolsep*}%
  \eqnlinesset{spread={\jot}}%
  \eqnlinesset{tagmargin}%
  \eqnlinesset{tagmarginratio=1}%
  \eqnlinesset{tagmarginthreshold=0.5}%
  \eqnlinesset{leftmargin={\leftmargini}}%
  \eqnlinesset{displayheight*}%
  \eqnlinesset{displaydepth*}%
  \eqnlinesset{shortmode=belowsingle}%
  \eqnlinesset{abovecontmode=short}%
  \eqnlinesset{belowcontmode=short}%
  \eqnlinesset{aboveparmode=long}%
  \eqnlinesset{belowparmode=long}%
  \eqnlinesset{abovetopmode=long}%
  \eqnlinesset{belowtopmode=long}%
  \eqnlinesset{abovelongskip={\abovedisplayskip}}%
  \eqnlinesset{belowlongskip={\belowdisplayskip}}%
  \eqnlinesset{aboveshortskip={\abovedisplayshortskip}}%
  \eqnlinesset{belowshortskip={\belowdisplayshortskip}}%
  \eqnlinesset{abovemedskip={.5\abovedisplayskip}}%
  \eqnlinesset{belowmedskip={.5\belowdisplayskip}}%
  \eqnlinesset{abovecontskip=0pt}%
  \eqnlinesset{belowcontskip=0pt}%
  \eqnlinesset{aboveparskip=0pt}%
  \eqnlinesset{belowparskip=0pt}%
  \eqnlinesset{abovetopskip=0pt}%
  \eqnlinesset{belowtopskip=0pt}%
  \eqnlinesset{abovetagskip=0pt}%
  \eqnlinesset{belowtagskip=0pt}%
  \eqnlinesset{abovemedtagskip=0pt}%
  \eqnlinesset{belowmedtagskip=0pt}%
  \eqnlinesset{abovepartagskip=0pt}%
  \eqnlinesset{belowpartagskip=0pt}%
}
\def\eql@defaults@eqnlines{%
  \eqnlinesset{mintagsep=.5em}%
  \eqnlinesset{maxcolsep=2em}%
  \eqnlinesset{spread={0.2\normalbaselineskip}}%
  \eqnlinesset{tagmargin}%
  \eqnlinesset{tagmarginratio=.334}%
  \eqnlinesset{tagmarginthreshold=0.5}%
  \eqnlinesset{leftmargin={\leftmargini}}%
  \eqnlinesset{displayheight}%
  \eqnlinesset{displaydepth}%
  \eqnlinesset{shortmode=above}%
  \eqnlinesset{abovecontmode=noskip}%
  \eqnlinesset{belowcontmode=long}%
  \eqnlinesset{aboveparmode=long}%
  \eqnlinesset{belowparmode=long}%
  \eqnlinesset{abovetopmode=noskip}%
  \eqnlinesset{belowtopmode=long}%
  \eqnlinesset{longskip={0.75\normalbaselineskip
    plus 0.25\normalbaselineskip minus 0.4\normalbaselineskip}}%
  \eqnlinesset{aboveshortskip={0.0\normalbaselineskip
    plus 0.25\normalbaselineskip}}%
  \eqnlinesset{belowshortskip={0.0\normalbaselineskip
    plus 0.25\normalbaselineskip}}%
  \eqnlinesset{medskip={0.4\normalbaselineskip
    plus 0.2\normalbaselineskip minus 0.2\normalbaselineskip}}%
  \eqnlinesset{abovecontskip=0pt}%
  \eqnlinesset{belowcontskip=0pt}%
  \eqnlinesset{aboveparskip=0pt}%
  \eqnlinesset{belowparskip=0pt}%
  \eqnlinesset{abovetopskip=0pt}%
  \eqnlinesset{belowtopskip=0pt}%
  \eqnlinesset{abovetagskip=0pt}%
  \eqnlinesset{belowtagskip=0pt}%
  \eqnlinesset{abovemedtagskip=0pt}%
  \eqnlinesset{belowmedtagskip=0pt}%
  \eqnlinesset{abovepartagskip=0pt}%
  \eqnlinesset{belowpartagskip=0pt}%
}
\newenvironment{eql@gathered}
  {\eqnaddopt{lines}\equationsbox}{\endequationsbox}
\newenvironment{eql@multlined}
  {\eqnaddopt{lines,padding,shape=steps}\equationsbox}{\endequationsbox}
\newenvironment{eql@aligned}
  {\eqnaddopt{align}\equationsbox}{\endequationsbox}
\newenvironment{eql@equation}
  {\eqnaddopt{equation}\equations}{\endequations}
\newenvironment{eql@gather}
  {\eqnaddopt{lines}\equations}{\endequations}
\newenvironment{eql@multline}
  {\eqnaddopt{lines,padmax,shape=steps,numberline=out}\equations}
  {\endequations}
\newenvironment{eql@align}
  {\eqnaddopt{align}\equations}{\endequations}
\newenvironment{eql@flalign}
  {\eqnaddopt{align,margins=false,maxcolsep*}\equations}{\endequations}
\newenvironment{eql@equation*}
  {\eqnaddopt{nonumber}\eql@equation}{\endequations}
\newenvironment{eql@gather*}
  {\eqnaddopt{nonumber}\eql@gather}{\endequations}
\newenvironment{eql@multline*}
  {\eqnaddopt{nonumber}\eql@multline}{\endequations}
\newenvironment{eql@align*}
  {\eqnaddopt{nonumber}\eql@align}{\endequations}
\newenvironment{eql@flalign*}
  {\eqnaddopt{nonumber}\eql@flalign}{\endequations}
\def\eql@provide@movecmd#1#2{%
  \expandafter\let\csname #1\expandafter\endcsname\csname #2\endcsname
}
\def\eql@provide@undefinecmd#1{%
  \expandafter\let\csname #1\endcsname\@undefined
}
\def\eql@provide@moveenv#1#2{%
  \expandafter\let\csname #1\expandafter\endcsname\csname #2\endcsname
  \expandafter\let\csname end#1\expandafter\endcsname\csname end#2\endcsname
}
\def\eql@provide@undefineenv#1{%
  \expandafter\let\csname #1\endcsname\@undefined
  \expandafter\let\csname end#1\endcsname\@undefined
}
\def\eql@provide@onlyonce#1#2{%
  \def\eql@tmp{#2}%
  \def\@tempa{#1}%
  \ifx\eql@tmp\@tempa
    \let\eql@tmp\@undefined
  \fi
  \ifx\eql@tmp\@empty
    \let\eql@tmp\@undefined
  \fi
  \def\@tempa{*}%
  \ifx\eql@tmp\@tempa
    \def\eql@tmp{#1}%
  \fi
  \ifdefined\eql@tmp\else
    \ifcsname eql@provided@#1\endcsname
      \def\eql@tmp{#1}%
    \else
      \expandafter\let\csname eql@provided@#1\endcsname\eql@true
    \fi
  \fi
}
\def\eql@provide@cmdonlyonce#1#2{%
  \def\eql@tmp{#2}%
  \edef\@tempb{\expandafter\noexpand\csname#1\endcsname}%
  \ifx\eql@tmp\@tempb
    \let\eql@tmp\@undefined
  \fi
  \ifx\eql@tmp\@empty
    \let\eql@tmp\@undefined
  \fi
  \def\@tempa{*}%
  \ifx\eql@tmp\@tempa
    \let\eql@tmp\@tempb
  \fi
  \ifdefined\eql@tmp
    \edef\eql@tmp{\expandafter\expandafter\expandafter\@gobble
      \expandafter\string\eql@tmp}%
  \else
    \ifcsname eql@provided@#1\endcsname
      \let\eql@tmp\@tempb
    \else
      \expandafter\let\csname eql@provided@#1\endcsname\eql@true
    \fi
  \fi
}
\def\eql@provide@cmd#1#2{%
  \eql@provide@cmdonlyonce{#1}{#2}%
  \ifdefined\eql@tmp
    \expandafter\eql@provide@movecmd\expandafter{\eql@tmp}{eql@#1}%
  \else
    \eql@amsmath@after{%
      \eql@provide@movecmd{ams#1}{#1}%
      \eql@provide@movecmd{#1}{eql@#1}%
    }%
    \AddToHook{package/mathtools/after}{%
      \eql@provide@movecmd{#1}{eql@#1}%
    }%
    \eql@provide@movecmd{#1}{eql@#1}%
    \eql@amsmath@before{\eql@provide@undefinecmd{#1}}%
  \fi
}
\def\eql@amsmath@endfix#1#2{%
  \long\edef\@tempa{\expandafter\noexpand\csname end#2\endcsname}%
  \long\edef\@tempb{\expandafter\noexpand\csname eql@amsmath@end#2\endcsname}%
  \expandafter\ifx\csname end#1\endcsname\@tempa
    \expandafter\let\csname end#1\endcsname\@tempb
  \fi
}
\def\eql@amsmath@fixends{%
  \eql@amsmath@after{%
    \let\eql@amsmath@endmultline\endmultline
    \eql@amsmath@endfix{multline*}{multline}%
    \let\eql@amsmath@endgather\endgather
    \eql@amsmath@endfix{gather*}{gather}%
    \let\eql@amsmath@endalign\endalign
    \eql@amsmath@endfix{align*}{align}%
    \eql@amsmath@endfix{flalign}{align}%
    \eql@amsmath@endfix{flalign*}{align}%
    \eql@amsmath@endfix{alignat}{align}%
    \eql@amsmath@endfix{alignat*}{align}%
    \eql@amsmath@endfix{xalignat}{align}%
    \eql@amsmath@endfix{xalignat*}{align}%
    \eql@amsmath@endfix{xxalignat}{align}%
    \let\eql@amsmath@endaligned\endaligned
    \eql@amsmath@endfix{gathered}{aligned}%
    \eql@amsmath@endfix{alignedat}{aligned}%
  }
}
\def\eql@provide@env#1#2{%
  \eql@provide@onlyonce{#1}{#2}%
  \ifdefined\eql@tmp
    \expandafter\eql@provide@moveenv\expandafter{\eql@tmp}{eql@#1}%
  \else
    \eql@amsmath@after{%
      \eql@provide@moveenv{ams#1}{#1}%
      \eql@provide@moveenv{ams#1*}{#1*}%
      \eql@provide@moveenv{#1}{eql@#1}%
      \eql@provide@moveenv{#1*}{eql@#1*}%
    }%
    \AddToHook{package/mathtools/after}{%
      \eql@provide@moveenv{#1}{eql@#1}%
      \eql@provide@moveenv{#1*}{eql@#1*}%
    }%
    \eql@provide@moveenv{#1}{eql@#1}%
    \eql@provide@moveenv{#1*}{eql@#1*}%
    \eql@amsmath@before{\eql@provide@undefineenv{#1}}%
    \eql@amsmath@before{\eql@provide@undefineenv{#1*}}%
  \fi
}
\def\eql@provide@env@equation#1{%
  \eql@provide@onlyonce{equation}{#1}%
  \ifdefined\eql@tmp
    \expandafter\eql@provide@moveenv\expandafter{\eql@tmp}{eql@equation}%
  \else
    \eql@amsmath@after{%
      \eql@provide@moveenv{amsequation}{equation}%
      \eql@provide@moveenv{amsequation*}{equation*}%
      \eql@provide@moveenv{equation}{eql@equation}%
      \eql@provide@moveenv{equation*}{eql@equation*}%
    }%
    \AddToHook{package/hyperref/after}{%
      \@ifpackageloaded{amsmath}{}{%
        \let\latexequation\H@equation
        \let\endlatexequation\H@endequation
        \eql@provide@moveenv{hyperrefequation}{equation}%
        \eql@provide@moveenv{equation}{eql@equation}%
      }%
    }%
    \@ifpackageloaded{amsmath}{}{\@ifpackageloaded{hyperref}{}{%
      \eql@provide@moveenv{latexequation}{equation}%
    }}%
    \eql@provide@moveenv{equation}{eql@equation}%
    \eql@provide@moveenv{equation*}{eql@equation*}%
    \eql@amsmath@before{\eql@provide@undefineenv{equation*}}%
    \ifdefined\eql@tagging@on
      \AddToHook{begindocument/end}{%
        \eql@provide@moveenv{equation}{eql@equation}%
        \eql@provide@moveenv{equation*}{eql@equation*}%
      }%
    \fi
  \fi
}
\def\eql@provide@env@multlined#1{%
  \eql@provide@onlyonce{multlined}{#1}%
  \ifdefined\eql@tmp
    \expandafter\eql@provide@moveenv\expandafter{\eql@tmp}{eql@multlined}%
  \else
    \AddToHook{package/mathtools/after}{%
      \eql@provide@moveenv{amsmultlined}{multlined}%
      \eql@provide@moveenv{multlined}{eql@multlined}%
    }%
    \eql@provide@moveenv{multlined}{eql@multlined}%
    \@ifpackageloaded{mathtools}{}{\AddToHook{package/mathtools/before}{%
      \eql@provide@undefineenv{multlined}}}%
  \fi
}
\def\eql@provide@env@subequations#1{%
  \eql@provide@onlyonce{subequations}{#1}%
  \ifdefined\eql@tmp
    \expandafter\eql@provide@moveenv
      \expandafter{\eql@tmp}{eql@subequations}%
  \else
    \eql@amsmath@after{%
      \eql@provide@moveenv{amssubequations}{subequations}%
      \eql@provide@moveenv{subequations}{eql@subequations}%
    }%
    \AddToHook{package/hyperref/after}{%
      \AddToHook{cmd/subequations/before}[hyperref]{}%
      \AddToHook{cmd/subequations/after}[hyperref]{}%
      \RemoveFromHook{cmd/subequations/before}[hyperref]%
      \RemoveFromHook{cmd/subequations/after}[hyperref]%
      \AddToHook{cmd/amssubequations/before}%
      {%
        \stepcounter{equation}%
        \protected@edef\theHparentequation{\theHequation}%
        \addtocounter{equation}{-1}%
      }%
      \AddToHook{cmd/amssubequations/after}%
      {%
        \def\theHequation{\theHparentequation\alph{equation}}%
        \ignorespaces
      }%
      \AddToHook{begindocument/end}{%
        \eql@provide@moveenv{subequations}{eql@subequations}%
      }%
    }%
    \eql@provide@moveenv{subequations}{eql@subequations}%
    \eql@amsmath@before{\eql@provide@undefineenv{subequations}}%
  \fi
}
\def\eql@provide@sqr{%
  \let\[\eql@equations@sqr@open
  \let\]\eql@equations@sqr@close
  \eql@amsmath@after{%
    \let\[\eql@equations@sqr@open
    \let\]\eql@equations@sqr@close
  }%
  \ifdefined\eql@tagging@on
    \AddToHook{begindocument/end}{%
      \let\[\eql@equations@sqr@open
      \let\]\eql@equations@sqr@close
    }%
  \fi
}
\def\eql@provide@ang{%
  \let\<\eql@equations@ang@open
  \let\>\eql@equations@ang@close
}
\eql@define@key{provide}{equation}[]{\eql@provide@env@equation{#1}}
\eql@define@key{provide}{gather}[]{\eql@provide@env{gather}{#1}}
\eql@define@key{provide}{multline}[]{\eql@provide@env{multline}{#1}}
\eql@define@key{provide}{align}[]{\eql@provide@env{align}{#1}}
\eql@define@key{provide}{flalign}[]{\eql@provide@env{flalign}{#1}}
\eql@define@key{provide}{aligned}[]{\eql@provide@env{aligned}{#1}}
\eql@define@key{provide}{gathered}[]{\eql@provide@env{gathered}{#1}}
\eql@define@key{provide}{multlined}[]{\eql@provide@env@multlined{#1}}
\eql@define@key{provide}{subequations}[]{\eql@provide@env@subequations{#1}}
\eql@define@key{provide}{sqr}[]{\eql@provide@sqr}
\eql@define@key{provide}{ang}[]{\eql@provide@ang}
\eql@define@key{provide}{eqref}[]{\eql@provide@cmd{eqref}{#1}}
\eql@define@key{provide}{tagform}[]{%
  \def\tagform@##1{\maketag@@@{\eql@tag@form{#1}}}}
\eql@define@key{provide}{maketag}[]{%
  \def\maketag@@@##1{\eql@tag@box{##1}}}
\newcommand{\eqnlinesprovide}[1]{%
  \eql@setkeys{provide}{#1}}
\newcommand{\eqnlinesset}[1]{%
  \eql@setkeys{setup}{#1}}
\let\eql@error@packageoption\@gobble
\DeclareOption{leqno}{\eqnlinesset{tagsleft}}
\DeclareOption{fleqn}{\eqnlinesset{left}}
\DeclareOption*{\expandafter\eqnlinesset\expandafter{\CurrentOption}}
\eql@defaults@eqnlines
\eql@mode@columns
\eql@mode@aligned
\ProcessOptions
\def\eql@error@packageoption#1{%
  \eql@error{may only use `#1' as a package option}%
}
\ifdefined\tagsleft@true\else
  \expandafter\newif\csname iftagsleft@\endcsname
\fi
\ifdefined\@fleqntrue\else
  \expandafter\newif\csname if@fleqn\endcsname
\fi
\ifdefined\eql@provide@opt@amsmath
  \let\eql@provide@opt@equation\eql@true
  \eql@amsmath@after{%
    \iftagsleft@
      \eqnlinesset{tagsleft}
    \else
      \eqnlinesset{tagsright}
    \fi
    \if@fleqn
      \eqnlinesset{left}
    \else
      \eqnlinesset{center}
    \fi
  }
\fi
\ifdefined\eql@provide@opt@equation\eqnlinesprovide{equation,sqr}\fi
\ifdefined\eql@provide@opt@amsmathends\eql@amsmath@fixends\fi
\ifdefined\eql@provide@opt@amsmath
  \eqnlinesprovide{%
    multline,gather,align,flalign,%
    multlined,gathered,aligned,%
    subequations}
\fi
\ifdefined\eql@provide@opt@ang\eqnlinesprovide{ang}\fi
\ifdefined\eql@provide@opt@eqref\eqnlinesprovide{eqref}\fi
\endinput
%%
%% End of file `eqnlines.sty'.
